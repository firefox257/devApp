{
  "messages": [
    {
      "role": "user",
      "content": "//use this code for reference"
    },
    {
      "role": "user",
      "content": "// ./ux/aichat.jsconst API_BASE_URL = \"https://gen.pollinations.ai/v1\";const MODELS_URL = `${API_BASE_URL}/models`;const CHAT_COMPLETIONS_URL = `${API_BASE_URL}/chat/completions`;// Local Storage Keysconst LOCAL_STORAGE_API_KEY = 'aiChatAPIKey';const LOCAL_STORAGE_MODELS_KEY = 'aiChatModels';const LOCAL_STORAGE_SELECTED_MODEL_KEY = 'aiChatSelectedModel';const LOCAL_STORAGE_SYSTEM_PROMPT_KEY = 'aiChatSystemPrompt';const LOCAL_STORAGE_MESSAGES_KEY = 'aiChatMessages';const LOCAL_STORAGE_SELECTED_SYSTEM_PROMPT_TITLE_KEY = 'aiChatSelectedSystemPromptTitle';const LOCAL_STORAGE_SELECTED_CODE_FILTER_KEY = 'aiChatSelectedCodeFilter';class AIChat extends HTMLElement {Â  constructor() {Â  Â  super();Â  Â  this.attachShadow({ mode: 'open' });Â  Â  this.models = [];Â  Â  this.currentModel = \"openai\";Â  Â  this.systemPrompt = \"You are a helpful AI assistant.\";Â  Â  this.systemPrompts = {};Â  Â  this.currentSystemPromptTitle = \"\";Â  Â  this.onCloseCallback = null;Â  Â  this.chatTitle = null;Â  Â  this.codeFilter = 'all';Â  Â  this.availableCodeTypes = new Set();Â  Â  this.apiKey = '';Â  Â  this.currentStreamReader = null;Â  Â  this.messages = [];Â  Â  this.render();Â  }Â  async connectedCallback() {Â  Â  const cachedAPIKey = localStorage.getItem(LOCAL_STORAGE_API_KEY);Â  Â  if (cachedAPIKey) {Â  Â  Â  this.apiKey = cachedAPIKey;Â  Â  }Â  Â  const cachedModel = localStorage.getItem(LOCAL_STORAGE_SELECTED_MODEL_KEY);Â  Â  if (cachedModel) {Â  Â  Â  this.currentModel = cachedModel;Â  Â  }Â  Â  await this.fetchSystemPrompts();Â  Â  const systemInput = this.shadowRoot.getElementById('systemInput');Â  Â  const systemPromptSelect = this.shadowRoot.getElementById('systemPromptSelect');Â  Â  const cachedSystemPromptContent = localStorage.getItem(LOCAL_STORAGE_SYSTEM_PROMPT_KEY);Â  Â  if (cachedSystemPromptContent) {Â  Â  Â  this.systemPrompt = cachedSystemPromptContent;Â  Â  Â  const foundKey = Object.keys(this.systemPrompts).find(key => this.systemPrompts[key] === cachedSystemPromptContent);Â  Â  Â  if (foundKey) {Â  Â  Â  Â  this.currentSystemPromptTitle = foundKey;Â  Â  Â  Â  if (systemPromptSelect) systemPromptSelect.value = this.currentSystemPromptTitle;Â  Â  Â  } else {Â  Â  Â  Â  this.currentSystemPromptTitle = \"custom\";Â  Â  Â  Â  if (systemPromptSelect) systemPromptSelect.value = \"custom\";Â  Â  Â  }Â  Â  } else {Â  Â  Â  const cachedSystemPromptTitle = localStorage.getItem(LOCAL_STORAGE_SELECTED_SYSTEM_PROMPT_TITLE_KEY);Â  Â  Â  if (cachedSystemPromptTitle && this.systemPrompts[cachedSystemPromptTitle]) {Â  Â  Â  Â  this.currentSystemPromptTitle = cachedSystemPromptTitle;Â  Â  Â  Â  this.systemPrompt = this.systemPrompts[this.currentSystemPromptTitle];Â  Â  Â  Â  if (systemPromptSelect) systemPromptSelect.value = cachedSystemPromptTitle;Â  Â  Â  } else if (Object.keys(this.systemPrompts).length > 0) {Â  Â  Â  Â  const defaultTitle = Object.keys(this.systemPrompts)[0];Â  Â  Â  Â  this.currentSystemPromptTitle = defaultTitle;Â  Â  Â  Â  this.systemPrompt = this.systemPrompts[defaultTitle];Â  Â  Â  Â  if (systemPromptSelect) systemPromptSelect.value = defaultTitle;Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SELECTED_SYSTEM_PROMPT_TITLE_KEY, defaultTitle);Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SYSTEM_PROMPT_KEY, this.systemPrompt);Â  Â  Â  }Â  Â  }Â  Â  if (systemInput) {Â  Â  Â  systemInput.textContent = this.systemPrompt;Â  Â  }Â  Â  this.messages = [{ role: 'system', content: this.systemPrompt }];Â  Â  await this.fetchModels();Â  Â  this.setupEventListeners();Â  Â  this.applyDynamicProperties();Â  Â  this.updateTitleBar();Â  Â  this.shadowRoot.getElementById('modelSelect').value = this.currentModel;Â  Â  const cachedCodeFilter = localStorage.getItem(LOCAL_STORAGE_SELECTED_CODE_FILTER_KEY);Â  Â  if (cachedCodeFilter) {Â  Â  Â  this.codeFilter = cachedCodeFilter;Â  Â  }Â  Â  this.populateCodeFilterDropdown();Â  Â  this.renderHistory();Â  }Â  disconnectedCallback() {Â  Â  if (this.onCloseCallback) {Â  Â  Â  this.onCloseCallback();Â  Â  }Â  Â  this.stopAIChatResponse();Â  }Â  static get observedAttributes() {Â  Â  return ['title', 'onclose'];Â  }Â  attributeChangedCallback(name, oldValue, newValue) {Â  Â  if (name === 'title') {Â  Â  Â  this.chatTitle = newValue;Â  Â  Â  this.updateTitleBar();Â  Â  } else if (name === 'onclose') {Â  Â  Â  try {Â  Â  Â  Â  this.onCloseCallback = window[newValue] || new Function(newValue);Â  Â  Â  } catch (e) {Â  Â  Â  Â  console.error(`Error parsing onClose attribute: ${e}`);Â  Â  Â  Â  this.onCloseCallback = null;Â  Â  Â  }Â  Â  Â  this.updateCloseButtonVisibility();Â  Â  }Â  }Â  applyDynamicProperties() {Â  Â  if (this.hasAttribute('title')) {Â  Â  Â  this.chatTitle = this.getAttribute('title');Â  Â  }Â  Â  if (this.hasAttribute('onclose')) {Â  Â  Â  try {Â  Â  Â  Â  this.onCloseCallback = window[this.getAttribute('onclose')] || new Function(this.getAttribute('onclose'));Â  Â  Â  } catch (e) {Â  Â  Â  Â  console.error(`Error parsing onClose attribute: ${e}`);Â  Â  Â  Â  this.onCloseCallback = null;Â  Â  Â  }Â  Â  }Â  Â  this.updateCloseButtonVisibility();Â  }Â  updateTitleBar() {Â  Â  const titleBar = this.shadowRoot.querySelector('.title-bar');Â  Â  const titleSpan = this.shadowRoot.querySelector('.title-text');Â  Â  if (titleBar && titleSpan) {Â  Â  Â  if (this.chatTitle) {Â  Â  Â  Â  titleSpan.textContent = this.chatTitle;Â  Â  Â  Â  titleBar.style.display = 'flex';Â  Â  Â  } else {Â  Â  Â  Â  titleBar.style.display = 'none';Â  Â  Â  }Â  Â  }Â  }Â  updateCloseButtonVisibility() {Â  Â  const closeButton = this.shadowRoot.getElementById('closeButton');Â  Â  if (closeButton) {Â  Â  Â  closeButton.style.display = this.onCloseCallback ? 'block' : 'none';Â  Â  }Â  }Â  async fetchModels() {Â  Â  const cachedModels = localStorage.getItem(LOCAL_STORAGE_MODELS_KEY);Â  Â  if (cachedModels) {Â  Â  Â  try {Â  Â  Â  Â  this.models = JSON.parse(cachedModels);Â  Â  Â  Â  this.populateModelDropdown();Â  Â  Â  Â  const isCachedModelAvailable = this.models.some(model => model.id === this.currentModel);Â  Â  Â  Â  if (!isCachedModelAvailable && this.models.length > 0) {Â  Â  Â  Â  Â  this.currentModel = this.models[0].id;Â  Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SELECTED_MODEL_KEY, this.currentModel);Â  Â  Â  Â  }Â  Â  Â  } catch (e) {Â  Â  Â  Â  localStorage.removeItem(LOCAL_STORAGE_MODELS_KEY);Â  Â  Â  }Â  Â  }Â  Â  try {Â  Â  Â  const headers = { 'Content-Type': 'application/json' };Â  Â  Â  if (this.apiKey) {Â  Â  Â  Â  headers['Authorization'] = `Bearer ${this.apiKey}`;Â  Â  Â  }Â  Â  Â  const response = await fetch(MODELS_URL, { headers });Â  Â  Â  if (!response.ok) {Â  Â  Â  Â  throw new Error(`HTTP error! status: ${response.status}`);Â  Â  Â  }Â  Â  Â  const data = await response.json();Â  Â  Â Â Â  Â  Â  let modelsArray;Â  Â  Â  if (Array.isArray(data)) {Â  Â  Â  Â  modelsArray = data;Â  Â  Â  } else if (data && Array.isArray(data.data)) {Â  Â  Â  Â  modelsArray = data.data;Â  Â  Â  } else {Â  Â  Â  Â  modelsArray = [];Â  Â  Â  }Â  Â  Â  this.models = modelsArray.map(model => ({Â  Â  Â  Â  id: model.id || model.name,Â  Â  Â  Â  name: model.name || model.id,Â  Â  Â  Â  description: model.description || model.name || model.idÂ  Â  Â  }));Â  Â  Â Â Â  Â  Â  this.populateModelDropdown();Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_MODELS_KEY, JSON.stringify(this.models));Â  Â  Â Â Â  Â  Â  const isCurrentModelAvailable = this.models.some(model => model.id === this.currentModel);Â  Â  Â  if (!isCurrentModelAvailable && this.models.length > 0) {Â  Â  Â  Â  this.currentModel = this.models[0].id;Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SELECTED_MODEL_KEY, this.currentModel);Â  Â  Â  }Â  Â  } catch (error) {Â  Â  Â  const modelSelect = this.shadowRoot.getElementById('modelSelect');Â  Â  Â  if (modelSelect) {Â  Â  Â  Â  modelSelect.innerHTML = `<option value=\"\">Error loading models</option>`;Â  Â  Â  }Â  Â  }Â  }Â  populateModelDropdown() {Â  Â  const modelSelect = this.shadowRoot.getElementById('modelSelect');Â  Â  if (!modelSelect) return;Â  Â Â Â  Â  modelSelect.innerHTML = '';Â  Â  this.models.forEach(model => {Â  Â  Â  const option = document.createElement('option');Â  Â  Â  option.value = model.id;Â  Â  Â  option.textContent = model.description || model.name || model.id;Â  Â  Â  modelSelect.appendChild(option);Â  Â  });Â  Â  modelSelect.value = this.currentModel;Â  }Â  async fetchSystemPrompts() {Â  Â  const fileName = 'systemPrompts.json';Â  Â  try {Â  Â  Â  const response = await fetch(fileName);Â  Â  Â  if (!response.ok) {Â  Â  Â  Â  this.systemPrompts = {};Â  Â  Â  Â  return;Â  Â  Â  }Â  Â  Â  this.systemPrompts = await response.json();Â  Â  Â  this.populateSystemPromptDropdown();Â  Â  } catch (error) {Â  Â  Â  this.systemPrompts = {};Â  Â  }Â  }Â  populateSystemPromptDropdown() {Â  Â  const systemPromptSelect = this.shadowRoot.getElementById('systemPromptSelect');Â  Â  if (!systemPromptSelect) return;Â  Â Â Â  Â  systemPromptSelect.innerHTML = '';Â  Â  const customOption = document.createElement('option');Â  Â  customOption.value = \"custom\";Â  Â  customOption.textContent = \"Custom\";Â  Â  systemPromptSelect.appendChild(customOption);Â  Â Â Â  Â  for (const title in this.systemPrompts) {Â  Â  Â  const option = document.createElement('option');Â  Â  Â  option.value = title;Â  Â  Â  option.textContent = title;Â  Â  Â  systemPromptSelect.appendChild(option);Â  Â  }Â  Â Â Â  Â  if (this.currentSystemPromptTitle && systemPromptSelect.querySelector(`option[value=\"${this.currentSystemPromptTitle}\"]`)) {Â  Â  Â  systemPromptSelect.value = this.currentSystemPromptTitle;Â  Â  } else {Â  Â  Â  systemPromptSelect.value = \"custom\";Â  Â  }Â  }Â  stripHtml(html) {Â  Â  const doc = new DOMParser().parseFromString(html, 'text/html');Â  Â  return doc.body.textContent || \"\";Â  }Â  clearConversation() {Â  Â  this.messages = [{ role: 'system', content: this.systemPrompt }];Â  Â  localStorage.removeItem(LOCAL_STORAGE_MESSAGES_KEY);Â  Â  this.availableCodeTypes.clear();Â  Â  this.codeFilter = 'all';Â  Â  localStorage.setItem(LOCAL_STORAGE_SELECTED_CODE_FILTER_KEY, this.codeFilter);Â  Â  this.populateCodeFilterDropdown();Â  Â  this.renderHistory();Â  Â  this.stopAIChatResponse();Â  }Â  stopAIChatResponse() {Â  Â  if (this.currentStreamReader) {Â  Â  Â  try {Â  Â  Â  Â  this.currentStreamReader.cancel();Â  Â  Â  } catch (e) {Â  Â  Â  } finally {Â  Â  Â  Â  this.currentStreamReader = null;Â  Â  Â  }Â  Â  }Â  }Â  setupEventListeners() {Â  Â  const sendButton = this.shadowRoot.getElementById('sendButton');Â  Â  const modelSelect = this.shadowRoot.getElementById('modelSelect');Â  Â  const systemPromptButton = this.shadowRoot.getElementById('systemPromptButton');Â  Â  const clearChatButton = this.shadowRoot.getElementById('clearChatButton');Â  Â  const systemPromptSelect = this.shadowRoot.getElementById('systemPromptSelect');Â  Â  const closeButton = this.shadowRoot.getElementById('closeButton');Â  Â  const systemInputContainer = this.shadowRoot.getElementById('systemInputContainer');Â  Â  const systemInput = this.shadowRoot.getElementById('systemInput');Â  Â  const textInputDiv = this.shadowRoot.getElementById('textInput');Â  Â  const apiKeyInput = this.shadowRoot.getElementById('apiKeyInput');Â  Â  const codeFilterSelect = this.shadowRoot.getElementById('codeFilterSelect');Â  Â  const copyConversationButton = this.shadowRoot.getElementById('copyConversationButton');Â  Â  const pasteConversationButton = this.shadowRoot.getElementById('pasteConversationButton');Â  Â  if (sendButton) sendButton.addEventListener('click', () => this.sendMessage());Â  Â  if (modelSelect) {Â  Â  Â  modelSelect.addEventListener('change', (event) => {Â  Â  Â  Â  this.currentModel = event.target.value;Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SELECTED_MODEL_KEY, this.currentModel);Â  Â  Â  });Â  Â  }Â  Â  if (systemPromptButton) systemPromptButton.addEventListener('click', () => {Â  Â  Â  systemInputContainer.style.display = systemInputContainer.style.display === 'none' ? 'block' : 'none';Â  Â  });Â  Â  if (clearChatButton) clearChatButton.addEventListener('click', () => this.clearConversation());Â  Â  if (apiKeyInput) {Â  Â  Â  apiKeyInput.addEventListener('input', (event) => {Â  Â  Â  Â  this.apiKey = event.target.value.trim();Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_API_KEY, this.apiKey);Â  Â  Â  });Â  Â  }Â  Â  if (systemPromptSelect) {Â  Â  Â  systemPromptSelect.addEventListener('change', (event) => {Â  Â  Â  Â  const selectedTitle = event.target.value;Â  Â  Â  Â  const systemInput = this.shadowRoot.getElementById('systemInput');Â  Â  Â  Â  if (selectedTitle === \"custom\") {Â  Â  Â  Â  Â  systemInput.textContent = this.systemPrompt;Â  Â  Â  Â  Â  this.currentSystemPromptTitle = \"custom\";Â  Â  Â  Â  } else if (this.systemPrompts[selectedTitle]) {Â  Â  Â  Â  Â  this.systemPrompt = this.systemPrompts[selectedTitle];Â  Â  Â  Â  Â  this.currentSystemPromptTitle = selectedTitle;Â  Â  Â  Â  Â  systemInput.textContent = this.systemPrompt;Â  Â  Â  Â  }Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SYSTEM_PROMPT_KEY, this.systemPrompt);Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SELECTED_SYSTEM_PROMPT_TITLE_KEY, this.currentSystemPromptTitle);Â  Â  Â  Â  if (this.messages.length > 0 && this.messages[0].role === 'system') {Â  Â  Â  Â  Â  this.messages[0].content = this.systemPrompt;Â  Â  Â  Â  } else {Â  Â  Â  Â  Â  this.messages.unshift({ role: 'system', content: this.systemPrompt });Â  Â  Â  Â  }Â  Â  Â  });Â  Â  }Â  Â  if (systemInput) {Â  Â  Â  systemInput.addEventListener('input', (event) => {Â  Â  Â  Â  this.systemPrompt = this.stripHtml(event.target.innerHTML).trim();Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SYSTEM_PROMPT_KEY, this.systemPrompt);Â  Â  Â  Â  const currentDropdownValue = systemPromptSelect ? systemPromptSelect.value : \"\";Â  Â  Â  Â  if (systemInput.textContent.trim() !== \"\" &&Â Â  Â  Â  Â  Â  Â  (currentDropdownValue === \"\" ||Â Â  Â  Â  Â  Â  Â  Â (this.systemPrompts[currentDropdownValue] !== systemInput.textContent.trim()))) {Â  Â  Â  Â  Â  this.currentSystemPromptTitle = \"custom\";Â  Â  Â  Â  Â  if (systemPromptSelect) systemPromptSelect.value = \"custom\";Â  Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SELECTED_SYSTEM_PROMPT_TITLE_KEY, \"custom\");Â  Â  Â  Â  }Â  Â  Â  Â  if (this.messages.length > 0 && this.messages[0].role === 'system') {Â  Â  Â  Â  Â  this.messages[0].content = this.systemPrompt;Â  Â  Â  Â  } else {Â  Â  Â  Â  Â  this.messages.unshift({ role: 'system', content: this.systemPrompt });Â  Â  Â  Â  }Â  Â  Â  });Â  Â  }Â  Â  if (textInputDiv) {Â  Â  Â  textInputDiv.addEventListener('keydown', (event) => {Â  Â  Â  Â  if (event.key === 'Enter' && !event.shiftKey) {Â  Â  Â  Â  Â  event.preventDefault();Â  Â  Â  Â  Â  this.sendMessage();Â  Â  Â  Â  }Â  Â  Â  });Â  Â  }Â  Â  if (closeButton) {Â  Â  Â  closeButton.addEventListener('click', () => {Â  Â  Â  Â  if (this.onCloseCallback) {Â  Â  Â  Â  Â  this.onCloseCallback();Â  Â  Â  Â  }Â  Â  Â  Â  this.remove();Â  Â  Â  });Â  Â  }Â  Â  if (codeFilterSelect) {Â  Â  Â  codeFilterSelect.addEventListener('change', (event) => {Â  Â  Â  Â  this.codeFilter = event.target.value;Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SELECTED_CODE_FILTER_KEY, this.codeFilter);Â  Â  Â  Â  this.renderHistory();Â  Â  Â  });Â  Â  }Â  Â  if (copyConversationButton) {Â  Â  Â  copyConversationButton.addEventListener('click', () => this.copyConversation());Â  Â  }Â  Â  if (pasteConversationButton) {Â  Â  Â  pasteConversationButton.addEventListener('click', () => this.pasteConversation());Â  Â  }Â  }Â  async copyConversation() {Â  Â  try {Â  Â  Â  const conversationData = {Â  Â  Â  Â  messages: this.messages.filter(msg => msg.role !== 'system'),Â  Â  Â  Â  timestamp: new Date().toISOString(),Â  Â  Â  Â  model: this.currentModel,Â  Â  Â  Â  systemPromptTitle: this.currentSystemPromptTitle,Â  Â  Â  Â  systemPrompt: this.systemPromptÂ  Â  Â  };Â  Â  Â Â Â  Â  Â  const jsonString = JSON.stringify(conversationData, null, 2);Â  Â  Â  await navigator.clipboard.writeText(jsonString);Â  Â  Â Â Â  Â  Â  const copyButton = this.shadowRoot.getElementById('copyConversationButton');Â  Â  Â  if (copyButton) {Â  Â  Â  Â  copyButton.textContent = 'âœ…';Â  Â  Â  Â  setTimeout(() => {Â  Â  Â  Â  Â  copyButton.textContent = 'ğŸ“‹';Â  Â  Â  Â  }, 1500);Â  Â  Â  }Â  Â  } catch (err) {Â  Â  Â  const copyButton = this.shadowRoot.getElementById('copyConversationButton');Â  Â  Â  if (copyButton) {Â  Â  Â  Â  copyButton.textContent = 'âŒ';Â  Â  Â  Â  setTimeout(() => {Â  Â  Â  Â  Â  copyButton.textContent = 'ğŸ“‹';Â  Â  Â  Â  }, 1500);Â  Â  Â  }Â  Â  }Â  }Â  async pasteConversation() {Â  Â  try {Â  Â  Â  const clipboardText = await navigator.clipboard.readText();Â  Â  Â  if (!clipboardText || clipboardText.trim() === '') {Â  Â  Â  Â  return;Â  Â  Â  }Â  Â  Â  let parsedData;Â  Â  Â  try {Â  Â  Â  Â  parsedData = JSON.parse(clipboardText);Â  Â  Â  } catch (jsonError) {Â  Â  Â  Â  return this.pasteConversationFromText(clipboardText);Â  Â  Â  }Â  Â  Â  if (!parsedData.messages || !Array.isArray(parsedData.messages)) {Â  Â  Â  Â  return;Â  Â  Â  }Â  Â  Â  const systemPromptToUse = parsedData.systemPrompt || this.systemPrompt;Â  Â  Â  const newMessages = [{ role: 'system', content: systemPromptToUse }];Â  Â  Â Â Â  Â  Â  parsedData.messages.forEach(msg => {Â  Â  Â  Â  if (msg.role && msg.content) {Â  Â  Â  Â  Â  newMessages.push({Â  Â  Â  Â  Â  Â  role: msg.role,Â  Â  Â  Â  Â  Â  content: msg.contentÂ  Â  Â  Â  Â  });Â  Â  Â  Â  }Â  Â  Â  });Â  Â  Â  this.messages = newMessages;Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_MESSAGES_KEY, JSON.stringify(this.messages));Â  Â  Â Â Â  Â  Â  this.availableCodeTypes.clear();Â  Â  Â  this.messages.forEach(msg => {Â  Â  Â  Â  const codeBlockRegex = /```(\\S*)[\\s\\S]*?```/g;Â  Â  Â  Â  let match;Â  Â  Â  Â  while ((match = codeBlockRegex.exec(msg.content)) !== null) {Â  Â  Â  Â  Â  const lang = match[1];Â  Â  Â  Â  Â  if (lang) {Â  Â  Â  Â  Â  Â  this.availableCodeTypes.add(lang.toLowerCase());Â  Â  Â  Â  Â  }Â  Â  Â  Â  }Â  Â  Â  });Â  Â  Â Â Â  Â  Â  if (parsedData.systemPrompt) {Â  Â  Â  Â  this.systemPrompt = parsedData.systemPrompt;Â  Â  Â  Â  this.currentSystemPromptTitle = parsedData.systemPromptTitle || \"custom\";Â  Â  Â  Â  const systemInput = this.shadowRoot.getElementById('systemInput');Â  Â  Â  Â  const systemPromptSelect = this.shadowRoot.getElementById('systemPromptSelect');Â  Â  Â  Â  if (systemInput) systemInput.textContent = this.systemPrompt;Â  Â  Â  Â  if (systemPromptSelect) systemPromptSelect.value = this.currentSystemPromptTitle;Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SYSTEM_PROMPT_KEY, this.systemPrompt);Â  Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SELECTED_SYSTEM_PROMPT_TITLE_KEY, this.currentSystemPromptTitle);Â  Â  Â  }Â  Â  Â Â Â  Â  Â  this.renderHistory();Â  Â  Â Â Â  Â  Â  const pasteButton = this.shadowRoot.getElementById('pasteConversationButton');Â  Â  Â  if (pasteButton) {Â  Â  Â  Â  pasteButton.textContent = 'âœ…';Â  Â  Â  Â  setTimeout(() => {Â  Â  Â  Â  Â  pasteButton.textContent = 'ğŸ“¥';Â  Â  Â  Â  }, 1500);Â  Â  Â  }Â  Â  } catch (err) {Â  Â  Â  const pasteButton = this.shadowRoot.getElementById('pasteConversationButton');Â  Â  Â  if (pasteButton) {Â  Â  Â  Â  pasteButton.textContent = 'âŒ';Â  Â  Â  Â  setTimeout(() => {Â  Â  Â  Â  Â  pasteButton.textContent = 'ğŸ“¥';Â  Â  Â  Â  }, 1500);Â  Â  Â  }Â  Â  }Â  }Â  pasteConversationFromText(text) {Â  Â  const lines = text.split('\\n');Â  Â  const newMessages = [{ role: 'system', content: this.systemPrompt }];Â  Â Â Â  Â  for (const line of lines) {Â  Â  Â  const trimmedLine = line.trim();Â  Â  Â  if (!trimmedLine) continue;Â  Â  Â  if (trimmedLine.startsWith('You: ')) {Â  Â  Â  Â  newMessages.push({Â  Â  Â  Â  Â  role: 'user',Â  Â  Â  Â  Â  content: trimmedLine.substring(4).trim()Â  Â  Â  Â  });Â  Â  Â  } else if (trimmedLine.startsWith('AI: ')) {Â  Â  Â  Â  newMessages.push({Â  Â  Â  Â  Â  role: 'assistant',Â  Â  Â  Â  Â  content: trimmedLine.substring(4).trim()Â  Â  Â  Â  });Â  Â  Â  }Â  Â  }Â  Â  this.messages = newMessages;Â  Â  localStorage.setItem(LOCAL_STORAGE_MESSAGES_KEY, JSON.stringify(this.messages));Â  Â Â Â  Â  this.availableCodeTypes.clear();Â  Â  this.messages.forEach(msg => {Â  Â  Â  const codeBlockRegex = /```(\\S*)[\\s\\S]*?```/g;Â  Â  Â  let match;Â  Â  Â  while ((match = codeBlockRegex.exec(msg.content)) !== null) {Â  Â  Â  Â  const lang = match[1];Â  Â  Â  Â  if (lang) {Â  Â  Â  Â  Â  this.availableCodeTypes.add(lang.toLowerCase());Â  Â  Â  Â  }Â  Â  Â  }Â  Â  });Â  Â Â Â  Â  this.renderHistory();Â  Â Â Â  Â  const pasteButton = this.shadowRoot.getElementById('pasteConversationButton');Â  Â  if (pasteButton) {Â  Â  Â  pasteButton.textContent = 'âœ…';Â  Â  Â  setTimeout(() => {Â  Â  Â  Â  pasteButton.textContent = 'ğŸ“¥';Â  Â  Â  }, 1500);Â  Â  }Â  }Â  populateCodeFilterDropdown() {Â  Â  const codeFilterSelect = this.shadowRoot.getElementById('codeFilterSelect');Â  Â  if (!codeFilterSelect) return;Â  Â Â Â  Â  const currentSelection = codeFilterSelect.value;Â  Â  codeFilterSelect.innerHTML = '';Â  Â Â Â  Â  const addOption = (value, text) => {Â  Â  Â  const option = document.createElement('option');Â  Â  Â  option.value = value;Â  Â  Â  option.textContent = text;Â  Â  Â  codeFilterSelect.appendChild(option);Â  Â  };Â  Â Â Â  Â  addOption('all', 'All');Â  Â  addOption('no-code', 'No Code');Â  Â  addOption('all-code', 'Code Only');Â  Â Â Â  Â  Array.from(this.availableCodeTypes).sort().forEach(type => {Â  Â  Â  addOption(type, type.toUpperCase());Â  Â  });Â  Â Â Â  Â  if (this.codeFilter && codeFilterSelect.querySelector(`option[value=\"${this.codeFilter}\"]`)) {Â  Â  Â  codeFilterSelect.value = this.codeFilter;Â  Â  } else {Â  Â  Â  codeFilterSelect.value = 'all';Â  Â  Â  this.codeFilter = 'all';Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_SELECTED_CODE_FILTER_KEY, this.codeFilter);Â  Â  }Â  }Â  renderHistory() {Â  Â  const rawTextOutputDiv = this.shadowRoot.getElementById('rawTextOutput');Â  Â  if (!rawTextOutputDiv) return;Â  Â Â Â  Â  rawTextOutputDiv.innerHTML = '';Â  Â  const displayMessages = this.messages.filter(msg => msg.role !== 'system');Â  Â Â Â  Â  if (displayMessages.length === 0) {Â  Â  Â  const welcomeP = document.createElement('p');Â  Â  Â  welcomeP.textContent = 'ğŸ¤–: How can I help you today?';Â  Â  Â  welcomeP.style.color = '#888';Â  Â  Â  welcomeP.style.fontSize = '0.9em';Â  Â  Â  rawTextOutputDiv.appendChild(welcomeP);Â  Â  }Â  Â Â Â  Â  displayMessages.forEach(msg => {Â  Â  Â  const codeBlockRegex = /```(\\S*)\\n([\\s\\S]*?)```/g;Â  Â  Â  let match;Â  Â  Â  let lastIndex = 0;Â  Â  Â  const fragment = document.createDocumentFragment();Â  Â  Â  let containsCode = false;Â  Â  Â Â Â  Â  Â  while ((match = codeBlockRegex.exec(msg.content)) !== null) {Â  Â  Â  Â  containsCode = true;Â  Â  Â  Â  const [fullMatch, lang, code] = match;Â  Â  Â  Â  const precedingText = msg.content.substring(lastIndex, match.index).trim();Â  Â  Â  Â Â Â  Â  Â  Â  if (precedingText) {Â  Â  Â  Â  Â  const p = document.createElement('p');Â  Â  Â  Â  Â  p.textContent = precedingText;Â  Â  Â  Â  Â  fragment.appendChild(p);Â  Â  Â  Â  }Â  Â  Â  Â Â Â  Â  Â  Â  const codeBlockContainer = document.createElement('div');Â  Â  Â  Â  codeBlockContainer.classList.add('code-block-container');Â  Â  Â  Â Â Â  Â  Â  Â  const header = document.createElement('div');Â  Â  Â  Â  header.classList.add('code-block-header');Â  Â  Â  Â Â Â  Â  Â  Â  const langSpan = document.createElement('span');Â  Â  Â  Â  langSpan.classList.add('code-lang');Â  Â  Â  Â  langSpan.textContent = lang || 'plaintext';Â  Â  Â  Â  header.appendChild(langSpan);Â  Â  Â  Â Â Â  Â  Â  Â  const copyButton = document.createElement('button');Â  Â  Â  Â  copyButton.classList.add('copy-button');Â  Â  Â  Â  copyButton.textContent = 'ğŸ“‹';Â  Â  Â  Â  copyButton.title = 'Copy';Â  Â  Â  Â  copyButton.onclick = () => this.copyToClipboard(code, copyButton);Â  Â  Â  Â  header.appendChild(copyButton);Â  Â  Â  Â Â Â  Â  Â  Â  codeBlockContainer.appendChild(header);Â  Â  Â  Â Â Â  Â  Â  Â  const pre = document.createElement('pre');Â  Â  Â  Â  const codeElement = document.createElement('code');Â  Â  Â  Â  codeElement.textContent = code;Â  Â  Â  Â  pre.appendChild(codeElement);Â  Â  Â  Â  codeBlockContainer.appendChild(pre);Â  Â  Â  Â Â Â  Â  Â  Â  fragment.appendChild(codeBlockContainer);Â  Â  Â  Â Â Â  Â  Â  Â  if (msg.role === 'assistant' && lang) {Â  Â  Â  Â  Â  this.availableCodeTypes.add(lang.toLowerCase());Â  Â  Â  Â  }Â  Â  Â  Â Â Â  Â  Â  Â  lastIndex = match.index + fullMatch.length;Â  Â  Â  }Â  Â  Â Â Â  Â  Â  const remainingText = msg.content.substring(lastIndex).trim();Â  Â  Â  if (remainingText || (!containsCode && msg.content.trim())) {Â  Â  Â  Â  const p = document.createElement('p');Â  Â  Â  Â  p.textContent = remainingText || msg.content;Â  Â  Â  Â  fragment.appendChild(p);Â  Â  Â  }Â  Â  Â Â Â  Â  Â  let shouldDisplay = false;Â  Â  Â  if (this.codeFilter === 'all') {Â  Â  Â  Â  shouldDisplay = true;Â  Â  Â  } else if (this.codeFilter === 'no-code') {Â  Â  Â  Â  shouldDisplay = !containsCode;Â  Â  Â  } else if (this.codeFilter === 'all-code') {Â  Â  Â  Â  shouldDisplay = containsCode;Â  Â  Â  } else {Â  Â  Â  Â  const filterLang = this.codeFilter;Â  Â  Â  Â  const messageContainsFilteredCode = [...msg.content.matchAll(codeBlockRegex)].some(([_, lang]) => lang.toLowerCase() === filterLang);Â  Â  Â  Â  shouldDisplay = messageContainsFilteredCode;Â  Â  Â  }Â  Â  Â Â Â  Â  Â  if (shouldDisplay) {Â  Â  Â  Â  if (!containsCode) {Â  Â  Â  Â  Â  const outerP = document.createElement('p');Â  Â  Â  Â  Â  outerP.textContent = `${msg.role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}: ${msg.content}`;Â  Â  Â  Â  Â  rawTextOutputDiv.appendChild(outerP);Â  Â  Â  Â  } else {Â  Â  Â  Â  Â  if (fragment.firstChild && fragment.firstChild.tagName === 'P') {Â  Â  Â  Â  Â  Â  fragment.firstChild.textContent = `${msg.role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}: ${fragment.firstChild.textContent}`;Â  Â  Â  Â  Â  } else if (fragment.firstChild && fragment.firstChild.classList.contains('code-block-container')) {Â  Â  Â  Â  Â  Â  const roleInfo = document.createElement('span');Â  Â  Â  Â  Â  Â  roleInfo.textContent = `${msg.role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}: `;Â  Â  Â  Â  Â  Â  rawTextOutputDiv.appendChild(roleInfo);Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  rawTextOutputDiv.appendChild(fragment);Â  Â  Â  Â  }Â  Â  Â  }Â  Â  });Â  Â Â Â  Â  this.populateCodeFilterDropdown();Â  Â  rawTextOutputDiv.scrollTop = rawTextOutputDiv.scrollHeight;Â  }Â  async copyToClipboard(text, button) {Â  Â  try {Â  Â  Â  await navigator.clipboard.writeText(text);Â  Â  Â  const originalText = button.textContent;Â  Â  Â  button.textContent = 'âœ…';Â  Â  Â  setTimeout(() => {Â  Â  Â  Â  button.textContent = 'ğŸ“‹';Â  Â  Â  }, 1500);Â  Â  } catch (err) {Â  Â  Â  button.textContent = 'âŒ';Â  Â  Â  setTimeout(() => {Â  Â  Â  Â  button.textContent = 'ğŸ“‹';Â  Â  Â  }, 1500);Â  Â  }Â  }Â  async sendMessage() {Â  Â  const userPrompt = this.stripHtml(this.shadowRoot.getElementById('textInput').innerHTML).trim();Â  Â  const temperature = parseFloat(this.shadowRoot.getElementById('temperatureInput').value);Â  Â  const rawTextOutputDiv = this.shadowRoot.getElementById('rawTextOutput');Â  Â  const textInputDiv = this.shadowRoot.getElementById('textInput');Â  Â  if (!this.apiKey || this.apiKey.trim() === '') {Â  Â  Â  rawTextOutputDiv.innerHTML = '<p style=\"color:red;font-size:0.9em;\">âš ï¸ API key required</p>';Â  Â  Â  return;Â  Â  }Â  Â  if (this.currentStreamReader) {Â  Â  Â  this.stopAIChatResponse();Â  Â  }Â  Â  if (!userPrompt) {Â  Â  Â  return;Â  Â  }Â  Â  if (isNaN(temperature) || temperature < 0 || temperature > 1) {Â  Â  Â  rawTextOutputDiv.innerHTML = '<p style=\"color:red;font-size:0.9em;\">âš ï¸ Invalid temperature</p>';Â  Â  Â  return;Â  Â  }Â  Â  this.messages.push({ role: 'user', content: userPrompt });Â  Â  this.renderHistory();Â  Â  textInputDiv.innerHTML = '';Â  Â  const aiResponseContainer = document.createElement('div');Â  Â  aiResponseContainer.innerHTML = '<p>ğŸ¤–: <span id=\"ai-response-content\"></span></p>';Â  Â  rawTextOutputDiv.appendChild(aiResponseContainer);Â  Â  const responseSpan = aiResponseContainer.querySelector('#ai-response-content');Â  Â  rawTextOutputDiv.scrollTop = rawTextOutputDiv.scrollHeight;Â  Â  const payload = {Â  Â  Â  \"model\": this.currentModel,Â  Â  Â  \"messages\": this.messages,Â  Â  Â  \"temperature\": temperature,Â  Â  Â  \"stream\": trueÂ  Â  };Â  Â  let fullResponse = '';Â  Â  try {Â  Â  Â  const headers = {Â  Â  Â  Â  'Content-Type': 'application/json',Â  Â  Â  Â  'Authorization': `Bearer ${this.apiKey}`Â  Â  Â  };Â  Â  Â Â Â  Â  Â  const response = await fetch(CHAT_COMPLETIONS_URL, {Â  Â  Â  Â  method: 'POST',Â  Â  Â  Â  headers: headers,Â  Â  Â  Â  body: JSON.stringify(payload)Â  Â  Â  });Â  Â  Â Â Â  Â  Â  if (!response.ok) {Â  Â  Â  Â  throw new Error(`HTTP error! status: ${response.status}`);Â  Â  Â  }Â  Â  Â Â Â  Â  Â  const reader = response.body.getReader();Â  Â  Â  this.currentStreamReader = reader;Â  Â  Â  const decoder = new TextDecoder('utf-8');Â  Â  Â Â Â  Â  Â  let buffer = '';Â  Â  Â  while (true) {Â  Â  Â  Â  const { done, value } = await reader.read();Â  Â  Â  Â  if (done) break;Â  Â  Â  Â Â Â  Â  Â  Â  buffer += decoder.decode(value, { stream: true });Â  Â  Â  Â Â Â  Â  Â  Â  let lines = buffer.split('\\n');Â  Â  Â  Â  buffer = '';Â  Â  Â  Â Â Â  Â  Â  Â  for (let line of lines) {Â  Â  Â  Â  Â  line = line.trim();Â  Â  Â  Â  Â Â Â  Â  Â  Â  Â  if (!line || line.startsWith('event:') || line.startsWith('id:') || line.startsWith('retry:')) {Â  Â  Â  Â  Â  Â  continue;Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â Â Â  Â  Â  Â  Â  if (line.startsWith('data: ')) {Â  Â  Â  Â  Â  Â  const data = line.substring(5).trim();Â  Â  Â  Â  Â  Â Â Â  Â  Â  Â  Â  Â  if (data === '[DONE]') {Â  Â  Â  Â  Â  Â  Â  break;Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â Â Â  Â  Â  Â  Â  Â  try {Â  Â  Â  Â  Â  Â  Â  const parsed = JSON.parse(data);Â  Â  Â  Â  Â  Â  Â  const content = parsed.choices?.[0]?.delta?.content;Â  Â  Â  Â  Â  Â  Â  if (content) {Â  Â  Â  Â  Â  Â  Â  Â  fullResponse += content;Â  Â  Â  Â  Â  Â  Â  Â  responseSpan.textContent = fullResponse;Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {Â  Â  Â  Â  Â  Â  Â  Â  Â  rawTextOutputDiv.scrollTop = rawTextOutputDiv.scrollHeight;Â  Â  Â  Â  Â  Â  Â  Â  }, 0);Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  } catch (jsonError) {Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  } else {Â  Â  Â  Â  Â  Â  buffer += line + '\\n';Â  Â  Â  Â  Â  }Â  Â  Â  Â  }Â  Â  Â  }Â  Â  Â Â Â  Â  Â  this.messages.push({ role: 'assistant', content: fullResponse });Â  Â  Â  localStorage.setItem(LOCAL_STORAGE_MESSAGES_KEY, JSON.stringify(this.messages));Â  Â  Â  this.renderHistory();Â  Â  Â Â Â  Â  } catch (error) {Â  Â  Â  if (responseSpan) {Â  Â  Â  Â  responseSpan.textContent = `âš ï¸ ${error.message || 'Error'}`;Â  Â  Â  Â  responseSpan.style.color = 'red';Â  Â  Â  }Â  Â  Â Â Â  Â  Â  if (this.messages[this.messages.length - 1]?.role === 'user' && this.messages[this.messages.length - 1]?.content === userPrompt) {Â  Â  Â  Â  this.messages.pop();Â  Â  Â  }Â  Â  Â Â Â  Â  Â  this.stopAIChatResponse();Â  Â  } finally {Â  Â  Â  this.currentStreamReader = null;Â  Â  }Â  }Â  render() {Â  Â  this.shadowRoot.innerHTML = `<style>:host {Â  display: flex;Â  flex-direction: column;Â  width: 100%;Â  height: 100%;Â  box-sizing: border-box;Â  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;Â  background-color: #fff;Â  color: #333;Â  overflow: hidden;}#mainChatTool {Â  display: flex;Â  flex-direction: column;Â  width: 100%;Â  height: 100%;Â  box-sizing: border-box;}.section {Â  padding: 6px 8px;Â  border-bottom: 1px solid #eee;Â  box-sizing: border-box;}.section:last-of-type {Â  border-bottom: none;}.title-bar {Â  display: flex;Â  align-items: center;Â  justify-content: space-between;Â  font-weight: bold;Â  white-space: nowrap;Â  overflow: hidden;Â  text-overflow: ellipsis;Â  flex-shrink: 0;Â  padding-bottom: 3px;}.title-text {Â  overflow: hidden;Â  text-overflow: clip;Â  white-space: nowrap;Â  font-size: 0.95em;}.top-menu {Â  display: flex;Â  justify-content: space-between;Â  align-items: center;Â  flex-shrink: 0;Â  gap: 4px;}.top-menu > div {Â  display: flex;Â  gap: 4px;Â  flex-grow: 1;Â  min-width: 0;Â  align-items: center;}.top-menu button, .top-menu select {Â  padding: 4px 8px;Â  border: 1px solid #ddd;Â  border-radius: 4px;Â  background-color: #fff;Â  cursor: pointer;Â  font-family: inherit;Â  font-size: 0.85em;Â  color: #333;Â  box-sizing: border-box;Â  min-height: 28px;}.top-menu button:hover, .top-menu select:hover {Â  background-color: #f5f5f5;}#modelSelect, #systemPromptSelect, #codeFilterSelect {Â  flex-grow: 1;Â  min-width: 0;Â  overflow: hidden;Â  text-overflow: ellipsis;Â  white-space: nowrap;}#systemInputContainer {Â  display: none;Â  padding-top: 8px;Â  padding-bottom: 4px;}.input-group {Â  margin-bottom: 6px;}.input-group label {Â  display: block;Â  margin-bottom: 3px;Â  font-weight: bold;Â  font-size: 0.8em;Â  color: #555;}.input-group input[type=\"number\"],.input-group input[type=\"password\"] {Â  width: calc(100% - 2px);Â  padding: 6px;Â  border: 1px solid #ddd;Â  border-radius: 4px;Â  font-size: 0.85em;Â  box-sizing: border-box;Â  font-family: inherit;Â  color: #333;}.input-group select {Â  width: calc(100% - 2px);Â  padding: 6px;Â  border: 1px solid #ddd;Â  border-radius: 4px;Â  font-size: 0.85em;Â  box-sizing: border-box;Â  font-family: inherit;Â  color: #333;}#textInput, #systemInput {Â  flex-grow: 1;Â  border: 1px solid #ddd;Â  background-color: #fff;Â  padding: 10px;Â  min-height: 60px;Â  max-height: 150px;Â  overflow-y: auto;Â  border-radius: 4px;Â  cursor: text;Â  font-family: inherit;Â  font-size: 0.95em;Â  line-height: 1.4;Â  box-sizing: border-box;Â  color: #333;Â  margin: 0;}#textInput[contenteditable=\"true\"]:focus,#systemInput[contenteditable=\"true\"]:focus {Â  outline: none;Â  border-color: #007bff;Â  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2);}#textInput:empty:before, #systemInput:empty:before {Â  content: attr(placeholder);Â  color: #aaa;Â  pointer-events: none;Â  display: block;}.chat-area {Â  flex-grow: 1;Â  overflow-x: hidden;Â  overflow-y: auto;Â  font-size: 0.9em;Â  line-height: 1.4;Â  background-color: #f9f9f9;Â  min-height: 50px;Â  box-sizing: border-box;Â  padding: 8px;Â  margin: 0;}.chat-area p {Â  margin: 0 0 6px 0;Â  white-space: pre-wrap;Â  word-break: normal;Â  font-size: 0.9em;}.chat-area p:last-child {Â  margin-bottom: 0;}.code-block-container {Â  background-color: #f4f4f4;Â  border: 1px solid #e1e1e1;Â  border-radius: 4px;Â  margin: 8px 0;Â  overflow: hidden;Â  font-size: 0.85em;}.code-block-header {Â  display: flex;Â  justify-content: space-between;Â  align-items: center;Â  background-color: #e9e9e9;Â  padding: 4px 8px;Â  border-bottom: 1px solid #e1e1e1;Â  font-size: 0.75em;Â  color: #555;}.code-lang {Â  font-weight: bold;Â  text-transform: uppercase;}.code-block-container pre {Â  margin: 0;Â  padding: 8px;Â  overflow-x: auto;Â  font-size: 0.85em;Â  line-height: 1.3;Â  white-space: pre-wrap;Â  word-break: break-all;Â  font-family: 'Courier New', monospace;}.code-block-container code {Â  display: block;}.copy-button {Â  background-color: #007bff;Â  color: white;Â  border: none;Â  border-radius: 3px;Â  padding: 2px 6px;Â  font-size: 0.75em;Â  cursor: pointer;Â  min-width: 24px;}.copy-button:hover {Â  background-color: #0056b3;}.input-area-wrapper {Â  display: flex;Â  align-items: flex-end;Â  gap: 6px;Â  flex-shrink: 0;Â  padding: 6px 8px;Â  background-color: #fff;Â  border-top: 1px solid #eee;Â  box-sizing: border-box;}#sendButton {Â  padding: 8px 12px;Â  background-color: #007bff;Â  color: white;Â  border: none;Â  border-radius: 4px;Â  cursor: pointer;Â  font-size: 1.3em;Â  flex-shrink: 0;Â  line-height: 1;Â  min-width: 44px;Â  height: 44px;}#sendButton:hover {Â  background-color: #0056b3;}.close-button {Â  background: none;Â  border: none;Â  font-size: 1.2em;Â  cursor: pointer;Â  color: #888;Â  padding: 0;Â  min-width: 28px;Â  height: 28px;}.close-button:hover {Â  color: #333;}</style><div id=\"mainChatTool\">Â  <div class=\"title-bar section\" style=\"display: none;\">Â  Â  <span class=\"title-text\"></span>Â  Â  <button id=\"closeButton\" class=\"close-button\" style=\"display: none;\">âœ•</button>Â  </div>Â Â Â  <div class=\"top-menu section\">Â  Â  <div>Â  Â  Â  <button id=\"systemPromptButton\" title=\"Settings\">âš™ï¸</button>Â  Â  Â  <select id=\"modelSelect\"></select>Â  Â  </div>Â  Â  <div>Â  Â  Â  <select id=\"codeFilterSelect\" title=\"Filter\"></select>Â  Â  Â  <button id=\"copyConversationButton\" title=\"Copy\">ğŸ“‹</button>Â  Â  Â  <button id=\"pasteConversationButton\" title=\"Paste\">ğŸ“¥</button>Â  Â  Â  <button id=\"clearChatButton\" title=\"Clear\">ğŸ—‘ï¸</button>Â  Â  </div>Â  </div>Â Â Â  <div id=\"systemInputContainer\" class=\"section\">Â  Â  <div class=\"input-group\">Â  Â  Â  <label for=\"apiKeyInput\">API Key:</label>Â  Â  Â  <input type=\"password\" id=\"apiKeyInput\" placeholder=\"API key\" value=\"${this.apiKey || ''}\">Â  Â  </div>Â  Â  <div class=\"input-group\">Â  Â  Â  <label for=\"systemPromptSelect\">System:</label>Â  Â  Â  <select id=\"systemPromptSelect\"></select>Â  Â  </div>Â  Â  <div class=\"input-group\">Â  Â  Â  <div id=\"systemInput\" contenteditable=\"true\" placeholder=\"System prompt...\"></div>Â  Â  </div>Â  Â  <div class=\"input-group\">Â  Â  Â  <label for=\"temperatureInput\">Temp:</label>Â  Â  Â  <input type=\"number\" id=\"temperatureInput\" value=\"0.7\" min=\"0\" max=\"1\" step=\"0.1\">Â  Â  </div>Â  </div>Â Â Â  <div id=\"rawTextOutput\" class=\"chat-area\" spellcheck=\"false\">Â  Â  <p style=\"color:#888;font-size:0.9em;\">ğŸ¤–: How can I help you today?</p>Â  </div>Â Â Â  <div class=\"input-area-wrapper\">Â  Â  <div id=\"textInput\" contenteditable=\"true\" placeholder=\"Type your message...\"></div>Â  Â  <button id=\"sendButton\">â¤</button>Â  </div></div>`;Â  }}if (!customElements.get('ai-chat')) {Â  customElements.define('ai-chat', AIChat);}const observer = new MutationObserver(mutations => {Â  mutations.forEach(mutation => {Â  Â  if (mutation.type === 'childList') {Â  Â  Â  mutation.addedNodes.forEach(node => {Â  Â  Â  Â  if (node.nodeType === 1 && node.tagName === 'AI-CHAT') {Â  Â  Â  Â  }Â  Â  Â  });Â  Â  }Â  });});observer.observe(document.body, { childList: true, subtree: true });document.addEventListener('DOMContentLoaded', () => {Â  document.querySelectorAll('ai-chat').forEach(chatElement => {Â  });});"
    },
    {
      "role": "assistant",
      "content": "I'd be happy to help you with code reference! However, I don't see any code provided in your message. Could you please share the code you'd like me to reference or help you with?\n\nOnce you provide the code, I can assist you with:\n- Explaining how it works\n- Identifying potential issues or improvements\n- Helping you understand specific parts of the code\n- Suggesting alternative approaches\n- Debugging problems\n\nPlease paste the code you'd like me to reference, and let me what specific help you need!"
    },
    {
      "role": "assistant",
      "content": "I've reviewed the provided code for the `AIChat` web component. Here's a summary and analysis:\n\n## Overview\nThis is a Web Component implementation for an AI chat interface that:\n- Communicates with a polling.ai API endpoint\n- Manages chat history with local storage persistence\n- Supports multiple AI models and system prompts\n- Includes code block filtering capabilities\n- Provides copy/paste conversation functionality\n\n## Key Features\n\n### Data Management\n- Uses localStorage for persisting API keys, models, system prompts, and chat history\n- Implements proper cleanup when component is removed\n\n### UI Components\n- Model selection dropdown\n- System prompt management with presets and custom editing\n- Temperature control slider\n- Code block filtering (all/no-code/code by language)\n- Copy/paste conversation functionality\n- Real-time chat display with code highlighting\n\n### API Integration\n- Fetches available models from `/v1/models`\n- Sends chat completions to `/v1/chat/completions` with streaming support\n- Handles API key authentication\n\n### Chat Features\n- Real-time streaming responses\n- Message history preservation\n- Code block detection and formatting\n- Conversation clearing and copying\n\n## Potential Improvements\n\n1. **Error Handling**: Could use more robust error handling for network issues\n2. **Accessibility**: Missing ARIA attributes for screen readers\n3. **Performance**: Large conversations could be optimized\n4. **Security**: API key handling could be improved (though it's already stored locally)\n\n## Usage Example\n```html\n<ai-chat title=\"My AI Assistant\" onclose=\"handleClose\"></ai-chat>\n```\n\nThe component is well-structured with proper separation of concerns and follows modern Web Components standards. The code is production-ready with good error handling and persistence mechanisms.\n\nWould you like me to explain any specific part in more detail or suggest modifications?"
    },
    {
      "role": "user",
      "content": "convert this html code into a module, use the aichat module as a model."
    },
    {
      "role": "user",
      "content": "<!DOCTYPE html><html><head>\t<title>pics</title></head><style>body{\tfont-size:10mm;}input, textarea{\tfont-size:10mm;}.prompt{\twidth:100vw;\theight:20vh;}.button{\tfont-size:15mm;\tborder:1mm solid #000;}.img{\twidth:100vw;}.inputs{}</style><body>\t<textarea class=\"prompt\"></textarea>\t<br/>\t<table>\t\t<tr>\t\t\t<td>\t\t\t\t<span class=\"button\" onclick=\"run();\">GO</span>\t\t\t</td>\t\t\t<td>\t\t\t\tW<input class=\"w\" type=\"text\" size=\"5\" value=\"828\"/>\t\t\t</td>\t\t\t<td>\t\t\t\tH<input class=\"h\" type=\"text\" size=\"5\" value=\"1792\"/>\t\t\t</td>\t\t\t<td>\t\t\t\tSeed<input class=\"seed\" type=\"text\" size=\"5\" value=\"0\"/>\t\t\t</td>\t\t\t<td>\t\t\t\tModel\t\t\t\t<select class=\"model\">\t\t\t\t\t<option value=\"none\">none</option>\t\t\t\t\t<option value=\"flux\">flux</option>\t\t\t\t\t<option value=\"turbo\">turbo</option>\t\t\t\t</select>\t\t\t</td>\t\t</tr>\t</table>\t<br/>\t<input class=\"more\"/>\t<img class=\"img\" onload=\"alert('done');\" onerror=\"alert('can not load image');\"/>\t<br/>\there\t<br/><br/><br/>\tggg\t<br/>\t<script>\tfunction $q(p)\t{\t\treturn document.querySelector(p);\t}\tvar prompt=$q(\".prompt\");\tvar img=$q(\".img\");\tvar w=$q(\".w\");\tvar h=$q(\".h\");\tvar seed=$q(\".seed\");\tvar model=$q(\".model\");\tfunction run()\t{\t\treform();\t\taddseed();\t\tvar dd = new Date();\t\tvar t =dd.getTime();\t\t//var u= \"https://image.pollinations.ai/prompt/\"+prompt.value+\"?width=\"+w.value+\"&height=\"+h.value+\"&nologo=true&seed=\"+seed.value+\"&model=\"+model.value +\"&private=true&$t=\"+ t;\t\tvar p=\"\";\t\tfor(var i = 0; i<prompt.value.length;i++ ){\t\t\tp+=\"%\"+prompt.value[i].charCodeAt(0).toString(16).toUpperCase();\t\t}\t\t//alert(p);\t\tvar u= \"https://image.pollinations.ai/prompt/\"+p+\"?width=\"+w.value+\"&height=\"+h.value+\"&nologo=true&model=\"+model.value +\"&private=true&seed=\"+ seed.value;\t\t$q(\".more\").value=u;\t\t//alert(u);\t\timg.src=u;\t}\tfunction addseed()\t{\t\tseed.value=(parseInt(seed.value)+1)+\"\";\t}\tfunction reform()\t{\t\tw.value=parseInt(w.value)+\"\";\t\th.value=parseInt(h.value)+\"\";\t\tseed.value=parseInt(seed.value)+\"\";\t}\t// Function to fetch models and populate the dropdown\tasync function populateModelsDropdown() {\t\ttry {\t\t\tconst response = await fetch('https://image.pollinations.ai/models');\t\t\tconst models = await response.json();\t\t\talert(\"done\");\t\t\t// Clear existing options, keeping \"none\" if desired\t\t\tmodel.innerHTML = '<option value=\"none\">none</option>';\t\t\tmodels.forEach(mod => {\t\t\t\tconst option = document.createElement('option');\t\t\t\toption.value = mod;\t\t\t\toption.textContent = mod;\t\t\t\tmodel.appendChild(option);\t\t\t});\t\t} catch (error) {\t\t\talert('Error fetching models:', error);\t\t\t// Optionally, add an error message to the dropdown or console\t\t}\t}\t// Call the function to populate the dropdown when the page loads\tdocument.addEventListener('DOMContentLoaded', populateModelsDropdown);\t</script></body></html>"
    },
    {
      "role": "assistant",
      "content": "```javascript\n// ./ux/picgen.js\nconst API_BASE = \"https://image.pollinations.ai\";\nconst MODELS_URL = `${API_BASE_URL}/models`;\nconst IMAGE_GENERATION_URL = `${API_BASE_URL}/prompt`;\n\n// Local Storage Keys\nconst LOCAL_STORAGE_API_KEY 'picGenAPIKey';\nconst LOCAL_STORAGE_MODELS_KEY = 'picGenModels';\nconst LOCAL_STORAGE_SELECTED_KEY = 'picGenSelectedModel';\n\nclass PicGen extends HTMLElement {\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open' });\n    this.models = [];\n    this.currentModel = \"none\";\n    this.apiKey = '';\n    this.render();\n  }\n\n  async connectedCallback() {\n    const cachedAPIKey = localStorage.getItem(LOCAL_STORAGE_API_KEY);\n    if (cachedAPIKey) {\n      this.apiKey =APIKey;\n    }\n    \n    const cachedModel = localStorage.getItem(LOCAL_STORAGE_SELECTED_MODEL_KEY);\n    if (cachedModel) {\n      this.currentModel = cachedModel;\n    }\n    \n    await this.fetchModels();\n    this.setupListeners();\n this.updateModelDropdown();\n  }\n\n  disconnectedCallback() {\n    // Cleanup if needed\n  }\n\n  static get observedAttributes() {\n    return ['title'];\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    if (name === 'title') {\n      this.updateTitleBar();\n    }\n }\n\n  updateTitleBar() {\n    const titleBar = this.shadowRoot.querySelector('.title-bar');\n    const titleSpan this.shadowRoot.querySelector('.title-text');\n    if (titleBar && titleSpan) {\n      if (this.hasAttribute('title'))        titleSpan.textContent = this.getAttribute('title');\n        titleBar.style.display = 'flex';\n      } else {\n        titleBar.style.display = 'none';\n      }\n    }\n  }\n\n  async fetchModels() {\n    const cachedModels = localStorage.getItem(LOCAL_STORAGE_MODELS_KEY);\n    if (cachedModels) {\n      try {\n        this.models = JSON.parse(cachedModels);\n        this.populateModelDropdown();\n        const isCachedModelAvailable = this.models.some(model => model === this.currentModel);\n        if (!isCachedModelAvailable && this.models.length > 0) {\n          this.currentModel = this.models[0];\n          localStorage.setItem(LOCAL_STORAGE_SELECTED_MODEL_KEY, this.currentModel);\n        }\n      } catch (e) {\n        localStorage.removeItem(LOCAL_STORAGE_MODELS_KEY);\n      }\n    }\n\n    try {\n      const response = await fetch(MODELS_URL);\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const data = await response.json();\n      \n      if (Array.isArray(data)) {\n        this.models = data;\n      } else if (data && Array.isArray(data.data)) {\n        this.models = data.data      } else {\n        this.models = [];\n      }\n      \n      this.populateModelDropdown();\n      localStorage.setItem(LOCAL_STORAGE_MODELS_KEY, JSON.stringify(this.models));\n      \n      const isCurrentModelAvailable = this.models.some(model => model === this.currentModel);\n      if (!isCurrentModelAvailable && this.models.length > 0) {\n        this.currentModel = this.models[0];\n        localStorage.setItem(LOCAL_STORAGE_SELECTED_MODEL_KEY, this.currentModel);\n      }\n    } catch (error) {\n      const modelSelect = this.shadowRoot.getElementById('modelSelect');\n      if (modelSelect) {\n        modelSelect.innerHTML = `<option value=\"none\">Error models</option>`;\n      }\n    }\n  }\n\n  populateModelDropdown() {\n    const modelSelect = this.shadowRoot.getElementById('modelSelect');\n    if (!modelSelect) return;\n    \n    model.innerHTML = '';\n    \n    // Add \"none\" option first\n    const noneOption = document.createElement('option');\n    noneOption.value = \"none\";\n    noneOption.textContent = \"none\";\n    modelSelect.appendChild(noneOption);\n    \n    this.models.forEach(model => {\n      const option = document.createElement('option');\n      option.value = model;\n      option.textContent = model;\n      modelSelect.appendChild(option);\n    });\n    \n    model.value = this.currentModel;\n  }\n\n  updateModelDropdown() {\n    const modelSelect = this.shadowRoot.getElementById('modelSelect');\n    if (modelSelect) {\n      modelSelect.value = this.currentModel;\n    }\n  }\n\n  setupEventListeners() {\n    const runButton = this.shadowRoot.getElementById('runButton');\n    const modelSelect = this.shadowRoot.getElementById('modelSelect');\n    const promptTextarea = this.shadowRoot.getElementById('promptTextarea');\n    const wInput = this.shadowRoot.getElementById('wInput');\n    const hInput = this.shadowRoot.getElementById('hInput');\n    const seedInput = this.shadowRoot.getElementById('seedInput');\n    const moreInput = this.shadowRoot.getElementById('moreInput');\n    const imgElement = this.shadowRoot.getElementById('imgElement');\n\n    if (runButton) {\n      runButton.addEventListener('click', () => this.run());\n    }\n\n    if (modelSelect) {\n      modelSelect.addEventListener('change', (event) => {\n        this.currentModel = event.target.value;\n        localStorage.setItem(LOCAL_STORAGE_SELECTED_MODEL_KEY, this.currentModel);\n      });\n    }\n\n    if (promptTextarea) {\n      promptTextarea.addEventListener('input', () => {\n        // Auto-resize textarea\n        promptTextarea.style.height = 'auto';\n        promptTextarea.style.height = Math.min(promptTextarea.scrollHeight, 300) + 'px';\n      });\n    }\n\n    if (imgElement) {\n      imgElement.addEventListener('load', () => {\n        // Show alert when image loads\n        // In a real implementation, you might want to show a success message instead\n      });\n      \n      imgElement.addEventListener('error', () {\n        // Handle image loading errors\n        console.error('Failed to load image');\n      });\n    }\n  }\n\n  run() {\n    const prompt this.shadowRoot('promptTextarea').value;\n    const w = this.shadowRoot.getElementById('wInput').value;\n    const h = this.shadowRoot.getElementById('hInput').value;\n    seed = this.shadowRoot.getElementById('seedInput').value;\n    const model = this.shadowRoot.getElementById('modelSelect').value;\n    const moreInput = this.shadowRoot.getElementById('moreInput');\n    const imgElement = this.shadowRoot.getElementById('imgElement');\n\n    Validate inputs\n    if (!prompt.trim()) {\n      alert('Please enter a prompt');\n      return;\n    }\n\n    // Format inputs\n    this.reform(w, h, seed);\n\n    // Encode prompt\n    let encodedPrompt = \"\";\n    for (let i = 0; i < prompt.length; i++) {\n      encodedPrompt += \"%\" + prompt[i].charCodeAt(0).toString(16).toUpperCase();\n    }\n\n    // Build URL\n    let u = `${IMAGE_GENERATION_URL}/${encodedPrompt}?width=${w}&height=${h}&nologo=true&model=${model}&=true&seed=${seed}`;\n    \n    // Display URL\n    moreInput.value = u;\n    \n    // Set image source\n    imgElement.src = u;\n    \n    // Update seed\n    this.addseed();\n  }\n\n  addseed() {\n    const seedInput = this.shadowRoot.getElementById('seed');\n    const current = parseInt(seedInput.value) || 0;\n    seedInput.value = (currentSeed + 1) + \"\";\n  }\n\n reform(w, h, seed) {\n    const wInput = this.shadowRoot.getElementById('wInput');\n    const hInput = this.shadowRoot.getElementById('hInput');\n    const seedInput = this.shadowRoot.getElementById('seedInput');\n    wInput.value = parseInt(w) || 0;\n    hInput.value = parseInt(h || 0;\n    seedInput.value = parseInt(seed) || 0;\n  }\n\n  render() {\n    this.shadowRoot.innerHTML = `\n      <style>\n        :host {\n          display: flex;\n          flex-direction: column;\n          width: 100%;\n          height: 100%;\n          box-sizing: border-box;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n          background-color: #fff;\n          color: #333;\n          overflow: hidden;\n        }\n        \n        #mainPicGen {\n          display: flex;\n          flex-direction: column;\n          width: 100%;\n          height: 100%;\n          box-sizing: border-box;\n        }\n        \n        .section {\n          padding 6px 8px;\n          border-bottom: 1px solid #eee;\n          box-sizing: border-box;\n        }\n        \n        .section:last-of-type {\n border-bottom none;\n        }\n        \n        .title-bar {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          font-weight: bold;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          flex-shrink: 0;\n          padding-bottom: 3px;\n        }\n        \n        .title-text {\n          overflow: hidden;\n          text-overflow: clip;\n          white-space: nowrap;\n          font-size: 0.95em;\n        }\n        \n        .top-menu {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          flex-shrink: 0;\n          gap: 4px;\n        }\n        \n        .top-menu > div {\n          display: flex;\n          gap: 4px;\n          flex-grow: 1;\n          min-width: 0;\n          align-items: center;\n        }\n        \n        .top-menu button, .-menu {\n          padding: 4px 8px;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          background-color: #fff;\n          cursor: pointer;\n          font-family: inherit;\n          font-size: 0.85em;\n          color: #33;\n          box-sizing: border-box;\n          min-height: 28px;\n        }\n        \n        .top-menu button:hover, .top-menu select:hover {\n          background-color: #f5f5f5        }\n        \n        #modelSelect {\n          flex-grow: 1;\n          min-width: 0;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n        }\n        \n        .input-group {\n          margin-bottom: 6px;\n        }\n        \n        .input-group label {\n          display: block;\n          margin-bottom: 3px;\n          font-weight: bold;\n          font-size: 0.em;\n          color: #555;\n        }\n        \n        .input-group input[type=\"text\"] {\n          width: calc(100% - 2px);\n          padding: 6px;\n border: 1px solid #ddd;\n          border-radius: 4px;\n          font-size: .85em;\n          box-sizing: border-box;\n          font-family: inherit;\n          color: #333;\n        }\n        \n        .input-group select {\n          width: calc(100% - 2px);\n          padding: 6px;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          font-size: 0.85em;\n          box-sizing: border-box;\n          font-family: inherit;\n          color: #333;\n        }\n        #promptTextarea {\n          width: 100%;\n          height: 20vh;\n          border: 1px solid #ddd;\n          background-color: #fff;\n          padding: 10px;\n          min-height: 60px;\n          max-height: 300px;\n          overflow-y: auto;\n          border-radius: 4px;\n          cursor: text;\n          font-family: inherit;\n          font-size: 10mm;\n          line-height: 1.4;\n          box-sizing: border-box;\n          color: #333;\n          margin: 0;\n        }\n        \n        #promptTextarea:focus          outline: none;\n          border-color: #007bff;\n          box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2);\n        }\n        \n        #Textarea::placeholder {\n          color: #aaa;\n        }\n        \n       controls {\n          display: flex;\n          flex-wrap: wrap;\n gap: 8px;\n          padding: 8px;\n          background-color: #f9f9f9;\n          border-bottom: 1px solid #eee;\n        }\n        \n        .control-item {\n          display: flex;\n          align-items: center;\n          gap: 4px;\n        }\n        \n        .button {\n         : 8px 12px;\n          background-color: #007bff;\n          color: white;\n          border: none;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 15mm;\n          font-weight: bold;\n          flex-shrink: 0;\n          min-width: 80px;\n        }\n        \n        .button:hover {\n          background-color: #056b3;\n        }\n        \n .img-container {\n          flex-grow: 1;\n          overflow: hidden;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          padding: 10px;\n          background-color: #f9f9f9;\n        }\n        \n        .img {\n          max-width:100%;\n          max-height: 70vh;\n          object-fit: contain;\n        }\n        \n        .more-input-container {\n padding: 8px;\n        }\n        \n        #moreInput {\n          width: 100%;\n padding:6px;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          font-size: 0.85em;\n          box-sizing: border-box;\n          font-family: monospace;\n          color: #333;\n        }\n        \n        .close-button {\n          background: none;\n          border: none;\n          font-size: 1.2em;\n          cursor: pointer;\n          color: #888;\n          padding: 0;\n          min-width: 28px;\n          height: 28px;\n        }\n        \n        .close-button:hover {\n          color: #333;\n        }\n      </style>\n      \n      <div id=\"mainPicGen\">\n        <div class=\"title-bar section\" style=\"display: none;\">\n          <span class=\"title-text\"></span>\n          <button class=\"close-button\" style=\"display: none;\"></button>\n        </div>\n        \n        <div class=\"section\">\n          <textarea id=\"promptTextarea\" class=\"prompt\" placeholder=\"Enter your image prompt here...\"></textarea>\n        </div>\n        \n        <div class=\"controls\">\n          <div=\"control-item\">\n            <button idrunButton\" class=\"button\">GO</button>\n          </div>\n          <div class=\"control-item\">\n            <span>W</span>\n            <input id=\"wInput\" class=\"w\" type=\"text\" size=\"5\" value=\"828\">\n          </div>\n          <div class=\"control-item\">\n            <span>H</span>\n            <input id=\"hInput\" class=\"h\" type=\"text\" size=\"5\" value=\"1792\">\n          </div>\n          <div class=\"control-item\">\n            <span>Seed</span>\n            <input id=\"seedInput\" class=\"seed\" type=\"text\" size=\"5\" value=\"0\">\n          </div>\n          <div class=\"control-item\">\n            <span>Model</span>\n            <select id=\"modelSelect\"></select>\n          </div>\n        </div>\n        \n        <div class=\"more-input-container\">\n          <input idmoreInput\" class=\"more\" type=\"text\" readonly placeholder=\"Generated URL will appear here...\">\n        </div>\n        \n        <div class=\"img-container\">\n          <img id=\"imgElement\" class=\"img\"=\"Generated image\"=\"display: none;\">\n        </div>\n      </div>\n    `;\n  }\n}\n\n// Register the custom element\nif (!customElements.get('pic-gen')) {\n  customElements.define('pic-gen', PicGen);\n}\n```"
    },
    {
      "role": "user",
      "content": "create a test html page to use picgen.js"
    },
    {
      "role": "assistant",
      "content": "```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>PicGen Test Page</title>\n    <script type=\"module\" src=\"./ux/picgen.js\"></script>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            margin: 0;\n            padding: 20px;\n            background-color: #f5f5f5;\n        }\n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n            background-color: white;\n            padding: 20px;\n            border-radius: 8px;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n        }\n        h1 {\n            color: #333;\n            text-align: center;\n        }\n        .picgen-container {\n            margin: 20px 0;\n        }\n        .instructions {\n            background-color: #8f4f8;\n            padding: 15px;\n            border-radius: 5px;\n            margin-bottom: 20px;\n        }\n        .instructions h2 {\n            margin-top: 0;\n            color: #2c3e50;\n        }\n        .instructions ul {\n            margin-bottom: 0;\n        }\n        .instructions li {\n            margin-bottom: 5px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>PicGen Test Page</1>\n        \n        <div class=\"instructions\">\n            <h2>How to Use PicGen</h2>\n            <ul>\n                <li>Enter a prompt in the text area</li>\n                <li>Adjust width, height, and seed values if needed</li>\n                <li>Select a model from the dropdown (flux, turbo, etc.)</li>\n                <li>Click \"GO\" to generate the image</li>\n                <li>The generated URL will appear in the input field below</li>\n                <li>Images will automatically display once generated</li>\n            </ul>\n        </div>\n\n        <div class=\"picgen-container\">\n            <pic-gen title=\"Image Generator\"></pic-gen>\n        </div>\n    </div>\n</body>\n</html>\n```"
    }
  ],
  "timestamp": "2026-02-01T19:54:12.458Z",
  "model": "qwen-coder",
  "systemPromptTitle": "Ai assisten.",
  "systemPrompt": "You are an A.I. assestent."
}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>CSG Editor - Help Documentation (Cleaned)</title>
        <style>
            /* BASE STYLES - Matching the CSG Editor Dark Theme */
            html,
            body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
            body {
                font-family: 'Segoe UI', sans-serif;
                background: #282c34; /* Dark background */
                color: #f8f8f8; /* Light text */
                padding: 20px;
                line-height: 1.6;
            }

            /* HEADINGS */
            h1,
            h2,
            h3,
            h4 {
                color: #61afef; /* Light Blue/Cyan for emphasis */
                padding-bottom: 8px;
                margin-top: 1.5em;
            }
            h1 {
                text-align: center;
                font-size: 2.2em;
                margin-bottom: 1em;
            }
            h2 {
                font-size: 1.8em;
            }
            h3 {
                font-size: 1.4em;
                color: #98c379; /* Green for secondary headings */
            }
            h4 {
                font-size: 1.2em;
                color: #e06c75; /* Red for tertiary headings/warnings */
            }

            /* LISTS AND PARAGRAPHS */
            p,
            li {
                margin: 10px 0;
            }
            ul,
            ol {
                padding-left: 20px;
            }

            /* TABLE OF CONTENTS (TOC) */
            .toc {
                background: #3e4451; /* Slightly lighter dark background */
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 30px;
            }
            .toc ul {
                list-style-type: none;
                padding-left: 0;
            }
            .toc li {
                margin: 8px 0;
            }
            .toc li ul {
                padding-left: 20px;
                list-style-type: disc;
            }
            .toc li ul li ul {
                padding-left: 20px;
                list-style-type: circle;
            }
            .toc a {
                color: #61afef;
                text-decoration: none;
            }
            .toc a:hover {
                text-decoration: underline;
            }

            /* TOOLBAR BUTTON DESCRIPTIONS */
            .button-desc {
                display: flex;
                align-items: center;
                gap: 15px; /* Increased gap for clarity */
                background: #3e4451;
                padding: 12px;
                border-radius: 6px;
                margin: 15px 0;
            }
            .button-icon {
                font-size: 1.8em; /* Slightly larger icon */
                width: 35px;
                height: 35px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 4px;
                font-weight: bold;
                /* Default background for consistency */
                background: #4a515e;
                color: #f8f8f8;
            }

            /* NAVIGATION BUTTONS */
            .nav-buttons {
                display: flex;
                justify-content: space-between;
                margin: 30px 0;
            }
            .nav-button {
                background: #3498db;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
                text-decoration: none;
                display: inline-block;
                transition: background 0.3s;
            }
            .nav-button:hover {
                background: #2980b9;
            }

            /* CODE AND NOTES */
            pre {
                background: #1e2127;
                border-left: 4px solid #e06c75;
                padding: 15px;
                margin: 20px 0;
                overflow-x: auto;
                white-space: pre-wrap; /* Allows long lines to wrap */
                word-wrap: break-word;
            }
            .example-title {
                font-weight: bold;
                color: #e06c75;
                margin-bottom: 10px;
            }
            .note {
                background: #3e4451;
                padding: 15px;
                border-radius: 6px;
                margin: 20px 0;
                border-left: 4px solid #61afef;
            }
            .warning {
                background: #544a4a;
                padding: 15px;
                border-radius: 6px;
                margin: 20px 0;
                border-left: 4px solid #e06c75;
            }

            /* TABLES */
            table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
                background: #3e4451;
            }
            th,
            td {
                border: 1px solid #545862;
                padding: 12px;
                text-align: left;
            }
            th {
                background: #2c3e50;
                color: #61afef;
            }
            tr:nth-child(even) {
                background: #34495e;
            }
            hr {
                border: 0;
                height: 1px;
                background: #545862;
                margin: 40px 0;
            }

            /* FIXED JUMP BACK BUTTON */
            #jump-back-btn {
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #61afef;
                color: #282c34;
                border: none;
                padding: 10px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-weight: bold;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
                z-index: 1000;
                display: none;
            }
            #jump-back-btn:hover {
                background: #569cd6;
                transform: translateY(-1px);
            }
        </style>
    </head>
    <body>
        <h1 id="top">CSG Editor - Help Documentation (Cleaned)</h1>
        <div class="toc">
            <h2>Table of Contents</h2>
            <ul>
                <li><a href="#about">1. About</a></li>
                <li><a href="#toolbar">2. How to Use the Toolbar</a></li>
                <li>
                    <a href="#settings">3. Settings</a>
                    <ul>
                        <li>
                            <a href="#grid-settings"
                                >Grid Width/Length/Spacing</a
                            >
                        </li>
                        <li><a href="#library-path">Library Path</a></li>
                        <li>
                            <a href="#settings-buttons"
                                >Buttons in Settings Panel</a
                            >
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#textcode">4. How to Use the TextCode Editor</a>
                    <ul>
                        <li>
                            <a href="#editor-interface"
                                >Editor Interface & Core Features</a
                            >
                        </li>
                        <li>
                            <a href="#toolbar-buttons"
                                >4.1 Toolbar Buttons: Icons and Functions</a
                            >
                        </li>
                        <li>
                            <a href="#bracket-selector">4.2 Bracket Selector</a>
                        </li>
                        <li>
                            <a href="#csg-vs-editor"
                                >4.3 Difference Between CSG Scripts and Editor
                                Scripts</a
                            >
                        </li>
                        <li>
                            <a href="#get-include"
                                >How to Use get() and include()</a
                            >
                        </li>
                        <li>
                            <a href="#external">External get() and include()</a>
                        </li>
                        <li>
                            <a href="#file-paths"
                                >How Paths Work (File Access)</a
                            >
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#path-creation">5. Paths: How to Create Them</a>
                    <ul>
                        <li><a href="#path-format">Path Format</a></li>
                        <li>
                            <a href="#path-commands">Path Commands Reference</a>
                        </li>
                        <li>
                            <a href="#auto-hole"
                                >Advanced: Automatic Hole Detection</a
                            >
                        </li>
                        <li>
                            <a href="#arcpath3d-helper"
                                ><code>arcPath3d()</code> Helper</a
                            >
                        </li>
                        <li><a href="#path-examples">Examples</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#commands"
                        >6. scadCSG Commands and How to Use Them</a
                    >
                    <ul>
                        <li><a href="#primitives">Primitive Shapes</a></li>
                        <li><a href="#transformations">Transformations</a></li>
                        <li><a href="#csg-operations">CSG Operations</a></li>
                        <li><a href="#extrusions">2D to 3D Extrusion</a></li>
                        <li>
                            <a href="#3d-imports"
                                >3D Imports (Requires <code>await</code>)</a
                            >
                        </li>
                        <li><a href="#utilities">Utility Functions</a></li>
                        <li>
                            <a href="#2d-path-manipulation"
                                >2D Path Manipulation</a
                            >
                        </li>
                        <li>
                            <a href="#text-functions"
                                >Text Functions (Requires <code>await</code>)</a
                            >
                        </li>
                    </ul>
                </li>
                <li><a href="#examples">7. Examples</a></li>
            </ul>
        </div>
        <section id="about">
            <h2>1. About</h2>
            <p>
                Welcome to the **CSG Editor**! This is a powerful,
                mobile-friendly, browser-based CAD (Computer-Aided Design) tool
                that lets you create complex 3D models using Constructive Solid
                Geometry (CSG) operations.
            </p>
            <p>
                You write scripts in a JavaScript-like syntax to define shapes
                (like cubes, spheres, cylinders), transform them (translate,
                rotate, scale), and combine them using boolean operations
                (union, difference, intersection). The result is rendered in
                real-time in the 3D view.
            </p>
            <p>
                This editor is designed for rapid prototyping, 3D printing
                preparation, and educational purposes. It combines the power of
                OpenSCAD-style scripting with the immediacy of a live 3D
                preview.
            </p>
        </section>
        <hr />
        <div class="nav-buttons">
            <a href="#toolbar" class="nav-button">Next: Toolbar &rarr;</a>
            <a href="#top" class="nav-button">↑ Top</a>
        </div>
        <section id="toolbar">
            <h2>2. How to Use the Toolbar</h2>
            <p>
                The toolbar at the top of the screen contains buttons to switch
                between different views and perform common actions. Here's what
                each button does, using the explicit Unicode character
                representations and correct color mappings:
            </p>

            <div class="button-desc">
                <div class="button-icon" style="background: #98c379">
                    &#x1F5BC;
                </div>
                <div>
                    <strong>3D View Button</strong> (<code>&#x1F5BC;</code> -
                    Picture Frame)<br />
                    Switches to the **3D Rendering View** where you can see and
                    interact with your model.
                </div>
            </div>

            <div class="button-desc">
                <div class="button-icon" style="background: #e06c75">
                    &#x1F4BB;
                </div>
                <div>
                    <strong>CSG Code Editor (Main Script)</strong> (<code
                        >&#x1F4BB;</code
                    >
                    - Laptop)<br />
                    Switches to the **CSG Script** editor. This is where you
                    write the main code that defines your 3D model.
                </div>
            </div>

            <div class="button-desc">
                <div class="button-icon" style="background: #61afef">
                    &#x2B9D;
                </div>
                <div>
                    <strong>Editor Code (Library/Include Script)</strong> (<code
                        >&#x2B9D;</code
                    >
                    - Down-Right Arrow)<br />
                    Switches to the **Editor Script** editor. This is where you
                    define reusable functions and constants for use in your CSG
                    scripts.
                </div>
            </div>

            <div class="button-desc">
                <div class="button-icon" style="background: #98c379">
                    &#x1F4CB;
                </div>
                <div>
                    <strong>Toggle Wireframe Button</strong> (<code
                        >&#x1F4CB;</code
                    >
                    - Clipboard)<br />
                    (Only visible in 3D View) Toggles the display of your model
                    between solid and **wireframe mode**.
                </div>
            </div>

            <div class="button-desc">
                <div class="button-icon" style="background: #dc3545">
                    &#x2716;
                </div>
                <div>
                    <strong>Clear Current Cache Button</strong> (<code
                        >&#x2716;</code
                    >
                    - Heavy Multiplication X)<br />
                    (Only visible in CSG or Editor Code views) Clears the cached
                    result for the currently active script tab.
                </div>
            </div>

            <div class="button-desc">
                <div class="button-icon" style="background: #61afef">
                    &#x2699;
                </div>
                <div>
                    <strong>Settings Button</strong> (<code>&#x2699;</code> -
                    Gear)<br />
                    Opens the Settings panel where you can configure the grid
                    size and library path.
                </div>
            </div>

            <div class="button-desc">
                <div class="button-icon" style="background: #98c379">
                    &#x1F4E5;
                </div>
                <div>
                    <strong>Load Project Button</strong> (<code>&#x1F4E5;</code>
                    - Incoming Envelope)<br />
                    Opens a file picker to load a previously saved project
                    (.json file).
                </div>
            </div>

            <div class="button-desc">
                <div class="button-icon" style="background: #98c379">
                    &#x1F4BE;
                </div>
                <div>
                    <strong>Save Project Button</strong> (<code>&#x1F4BE;</code>
                    - Floppy Disk)<br />
                    Saves the current project, including all scripts and cached
                    geometry.
                </div>
            </div>

            <div class="button-desc">
                <div class="button-icon" style="background: #61afef">
                    &#x2753;
                </div>
                <div>
                    <strong>Help Button</strong> (<code>&#x2753;</code> - Black
                    Question Mark Ornament)<br />
                    Opens this help documentation.
                </div>
            </div>

            <div class="button-desc">
                <div class="button-icon" style="background: #dc3545">
                    &#x1F5D1;
                </div>
                <div>
                    <strong>Clear Console Button</strong> (<code
                        >&#x1F5D1;</code
                    >
                    - Wastebasket)<br />
                    Clears all messages from the console panel at the bottom of
                    the screen.
                </div>
            </div>

            <p><strong>Keyboard Shortcuts:</strong></p>
            <ul>
                <li>
                    <code>Ctrl+S</code> / <code>Cmd+S</code>: Open the Save
                    dialog.
                </li>
                <li>
                    <code>Ctrl+F</code> / <code>Cmd+F</code>: Open the Find
                    dialog in the code editor.
                </li>
                <li><code>F3</code>: Find next occurrence.</li>
                <li><code>Shift+F3</code>: Find previous occurrence.</li>
            </ul>
        </section>
        <hr />
        <div class="nav-buttons">
            <a href="#settings" class="nav-button">Next: Settings &rarr;</a>
            <a href="#top" class="nav-button">↑ Top</a>
        </div>
        <section id="settings">
            <h2>3. Settings</h2>
            <p>
                The Settings panel allows you to configure the environment for
                your 3D modeling.
            </p>
            <h3 id="grid-settings">Grid Width / Length / Spacing</h3>
            <p>
                Sets the dimensions (X, Y) and line separation of the build
                plate grid in millimeters. These define your build envelope.
            </p>
            <h3 id="library-path">Library Path</h3>
            <p>
                This is the base path used when you use the
                <code>$lib/</code> prefix in your <code>get()</code> or
                <code>include()</code> functions. For example,
                <code>get("MyPart", "$lib/part1.json")</code> will look for the
                file at the path defined here.
            </p>
            <div class="note">
                <p>
                    <strong>Note:</strong> These settings are saved in your
                    browser's local storage and will persist between sessions.
                </p>
            </div>
            <h3 id="settings-buttons">Buttons in Settings Panel</h3>
            <div class="button-desc">
                <div class="button-icon" style="background: #28a745">
                    &#x1F4BE;
                </div>
                <div>
                    <strong>Save Settings Button</strong><br />
                    Saves the current settings to local storage.
                </div>
            </div>
            <div class="button-desc">
                <div class="button-icon" style="background: #dc3545">
                    &#x1F9F9;
                </div>
                <div>
                    <strong>Clear All Cache Button</strong><br />
                    Clears all in-memory caches (mesh cache, code cache, file
                    cache) and removes all objects from the 3D scene. You will
                    need to click "Run" in the CSG editor to re-render your
                    model.
                </div>
            </div>
        </section>
        <hr />
        <div class="nav-buttons">
            <a href="#textcode" class="nav-button"
                >Next: TextCode Editor &rarr;</a
            >
            <a href="#top" class="nav-button">↑ Top</a>
        </div>
        <section id="textcode">
            <h2>4. How to Use the TextCode Editor</h2>
            <p>
                The TextCode editor is a powerful, multi-tab code editor built
                specifically for this application. It features syntax-aware
                indentation, find/replace, go-to-line, and multi-page support.
            </p>
            <h3 id="editor-interface">Editor Interface & Core Features</h3>
            <p>The editor offers:</p>
            <ul>
                <li>
                    **Smart Indentation**: Handles indentation automatically
                    when typing brackets <code>{</code>, <code>[</code>, or
                    <code>(</code>.
                </li>
                <li>
                    **Multi-Page Support**: Use the "Pages" menu to switch
                    between multiple script tabs, rename them, or create a new
                    one.
                </li>
                <li>
                    **Find & Replace**: Press <code>Ctrl+F</code> (or
                    <code>Cmd+F</code>) to search for text.
                </li>
                <li>
                    **Beautify Button**: Automatically formats and indents your
                    code for readability.
                </li>
            </ul>
            <section id="toolbar-buttons">
                <h3>4.1 Toolbar Buttons: Icons and Functions</h3>
                <p>The editor's internal toolbar:</p>
                <div class="button-desc">
                    <div class="button-icon" style="background: #3e4451">
                        &#x21A9;
                    </div>
                    <div>
                        <strong>Undo</strong> (<code>&#x21A9;</code> - Left
                        Arrow Curving Rightward)
                    </div>
                </div>
                <div class="button-desc">
                    <div class="button-icon" style="background: #3e4451">
                        &#x21AA;
                    </div>
                    <div>
                        <strong>Redo</strong> (<code>&#x21AA;</code> - Right
                        Arrow Curving Leftward)
                    </div>
                </div>
                <div class="button-desc">
                    <div class="button-icon" style="background: #3e4451">
                        &#x1F524;
                    </div>
                    <div>
                        <strong>Select All</strong> (<code>&#x1F524;</code> -
                        Keycap A)
                    </div>
                </div>
                <div class="button-desc">
                    <div class="button-icon" style="background: #3e4451">
                        &#x1F517;
                    </div>
                    <div>
                        <strong>Select Bracket Content</strong> (<code
                            >&#x1F517;</code
                        >
                        - Link/Chain) - *See section 4.2*
                    </div>
                </div>
                <div class="button-desc">
                    <div class="button-icon" style="background: #3e4451">
                        &#x23;
                    </div>
                    <div>
                        <strong>Go To Line</strong> (<code>&#x23;</code> - Hash
                        Symbol)
                    </div>
                </div>
                <div class="button-desc">
                    <div class="button-icon" style="background: #3e4451">
                        &#x1F50D;
                    </div>
                    <div>
                        <strong>Find</strong> (<code>&#x1F50D;</code> -
                        Right-pointing Magnifying Glass)
                    </div>
                </div>
                <div class="button-desc">
                    <div class="button-icon" style="background: #3e4451">
                        &#x1F5C3;
                    </div>
                    <div>
                        <strong>Pages Menu</strong> (<code>&#x1F5C3;</code> -
                        Folders) - Switch, Rename, or Create Tabs.
                    </div>
                </div>
                <div class="button-desc">
                    <div class="button-icon" style="background: #3e4451">
                        &#x25B6;
                    </div>
                    <div>
                        <strong>Run</strong> (<code>&#x25B6;</code> - Play
                        Button) - Executes the code in the current tab.
                    </div>
                </div>
                <div class="button-desc">
                    <div class="button-icon" style="background: #3e4451">
                        &#x1F4BE;
                    </div>
                    <div>
                        <strong>Save</strong> (<code>&#x1F4BE;</code> - Floppy
                        Disk) - Triggers the save project dialog.
                    </div>
                </div>
                <div class="button-desc">
                    <div class="button-icon" style="background: #3e4451">
                        &#x2716;
                    </div>
                    <div>
                        <strong>Close</strong> (<code>&#x2716;</code> - Heavy
                        Multiplication X) - Closes the current editor view.
                    </div>
                </div>
                <div class="button-desc">
                    <div class="button-icon" style="background: #3e4451">
                        &#x2728;
                    </div>
                    <div>
                        <strong>Beautify</strong> (<code>&#x2728;</code> -
                        Sparkles) - Automatically formats and indents code.
                    </div>
                </div>
            </section>

            <section id="bracket-selector">
                <h3>4.2 Bracket Selector (<code>&#x1F517;</code>)</h3>
                <p>
                    The **Select Bracket Content** button helps you quickly
                    select a defined code block, which is essential for rapid
                    copying, moving, or commenting out sections of code.
                </p>
                <ul>
                    <li>
                        **Function:** When your cursor is immediately inside or
                        next to an opening or closing bracket (e.g., inside
                        <code>{}</code>, <code>()</code>, <code>[]</code>, or
                        <code>&lt;&gt;</code>), clicking this button will
                        automatically select the entire content, including the
                        matching brackets themselves.
                    </li>
                    <li>
                        **Supported Brackets:** <code>{}</code> (curly braces),
                        <code>[]</code> (square brackets),
                        <code>()</code> (parentheses), and
                        <code>&lt;&gt;</code> (angle brackets/generics).
                    </li>
                </ul>
                <div class="example-block">
                    <div class="example-title">Example Usage:</div>
                    <pre><code>function createObject() {
    // Put the cursor anywhere here ⇩
    const myObject = union([
        cube([10, 10, 10]),
        sphere({ r: 5 })
    ]); // ⮤ ... or here.
    return myObject;
}</code></pre>
                    <p>
                        Clicking the button will select the entire `union(...)`
                        statement, including the outer parentheses.
                    </p>
                </div>
            </section>

            <section id="csg-vs-editor">
                <h3>4.3 Difference Between CSG Scripts and Editor Scripts</h3>
                <p>There are two main types of scripts:</p>
                <ul>
                    <li>
                        **CSG Scripts (Main Design - Red Monitor
                        <code>&#x1F4BB;</code>):** Must return a 3D object or
                        array of objects. This is the code that is rendered.
                    </li>
                    <li>
                        **Editor Scripts (Library Code - Blue Editor
                        <code>&#x2B9D;</code>):** Must return an object
                        containing reusable functions, constants, or complex
                        path data. This code is never rendered directly.
                    </li>
                </ul>
            </section>
            <section id="get-include">
                <h3>
                    How to Use <code>get()</code> and <code>include()</code>
                </h3>
                <p>These functions are used for code modularity:</p>
                <ul>
                    <li>
                        <code>include(name)</code>: Used in a CSG script to load
                        the exports object from an **Editor Script** tab.
                    </li>
                    <li>
                        <code>get(name)</code>: Used in a CSG script to load the
                        3D model result from another **CSG Script** tab.
                    </li>
                </ul>
            </section>
            <section id="external">
                <h3>External <code>get()</code> and <code>include()</code></h3>
                <p>
                    You can also load scripts from external JSON project files
                    using the two-argument form:
                </p>
                <ul>
                    <li>
                        <code>include(name, filepath)</code>: Loads an Editor
                        script named <code>name</code> from a file.
                    </li>
                    <li>
                        <code>get(name, filepath)</code>: Loads a CSG script
                        named <code>name</code> from a file.
                    </li>
                </ul>
            </section>
            <section id="file-paths">
                <h3>How Paths Work (File Access)</h3>
                <p>
                    When loading external files, the path is resolved based on
                    its prefix:
                </p>
                <ol>
                    <li>
                        **Absolute Paths:** Start with <code>/</code> (from the
                        root of your storage).
                    </li>
                    <li>
                        **Library Paths:** Start with
                        <code>$lib/</code> (resolved relative to the **Library
                        Path** setting).
                    </li>
                    <li>
                        **Relative Paths:** Otherwise, the path is relative to
                        the directory of the currently loaded project file.
                    </li>
                </ol>
            </section>
        </section>
        <hr />
        <div class="nav-buttons">
            <a href="#path-creation" class="nav-button">Next: Paths &rarr;</a>
            <a href="#top" class="nav-button">↑ Top</a>
        </div>
        <section id="path-creation">
            <h2>5. Paths: How to Create Them</h2>
            <p>
                2D paths are the foundation for complex extruded shapes. They
                are defined as an object with a flat array of commands:
            </p>
            <h3 id="path-format">Path Format</h3>
            <pre><code>{
    path: [
        'm', x, y,           // Move to (Absolute)
        'lr', dx, dy,        // Line to (Relative)
        'q', cx, cy, x, y,   // Quadratic Bezier (Absolute)
        'a', cx, cy, r, startAngle, endAngle, clockwise, // Arc 
    ],
    fn: 40 // Optional: resolution for curves
}</code></pre>
            <div class="note">
                <p>
                    <strong>Note on 2D Coordinates:</strong> The 2D path system
                    uses a **Y-up coordinate system**, meaning positive X is
                    right and positive Y is up, matching the standard
                    mathematical plane.
                </p>
            </div>
            <h3 id="path-commands">Path Commands Reference</h3>
            <p>
                Path commands are case-sensitive. Absolute commands use
                lowercase letters, and relative commands use the letter followed
                by `r` (e.g., `l` vs `lr`).
            </p>
            <table>
                <thead>
                    <tr>
                        <th>Command</th>
                        <th>Type</th>
                        <th>Syntax</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>m</code></td>
                        <td>Absolute (2D)</td>
                        <td><code>'m', x, y</code></td>
                        <td>
                            Move To (Starts a new sub-path at absolute
                            coordinates).
                        </td>
                    </tr>
                    <tr>
                        <td><code>mr</code></td>
                        <td>Relative (2D)</td>
                        <td><code>'mr', dx, dy</code></td>
                        <td>
                            Move To (Starts a new sub-path relative to the
                            current position).
                        </td>
                    </tr>
                    <tr>
                        <td><code>l</code></td>
                        <td>Absolute (2D)</td>
                        <td><code>'l', x, y</code></td>
                        <td>
                            Line To (Draws a straight line to absolute
                            coordinates).
                        </td>
                    </tr>
                    <tr>
                        <td><code>lr</code></td>
                        <td>Relative (2D)</td>
                        <td><code>'lr', dx, dy</code></td>
                        <td>
                            Line To (Draws a straight line relative to the
                            current position).
                        </td>
                    </tr>
                    <tr>
                        <td><code>q</code></td>
                        <td>Absolute (2D)</td>
                        <td><code>'q', cx, cy, x, y</code></td>
                        <td>
                            Quadratic Bezier Curve (Control point and end point
                            are absolute).
                        </td>
                    </tr>
                    <tr>
                        <td><code>qr</code></td>
                        <td>Relative (2D)</td>
                        <td><code>'qr', dcx, dcy, dx, dy</code></td>
                        <td>
                            Quadratic Bezier Curve (Control point and end point
                            are relative offsets).
                        </td>
                    </tr>
                    <tr>
                        <td><code>c</code></td>
                        <td>Absolute (2D)</td>
                        <td><code>'c', cx1, cy1, cx2, cy2, x, y</code></td>
                        <td>
                            Cubic Bezier Curve (Control points and end point are
                            absolute).
                        </td>
                    </tr>
                    <tr>
                        <td><code>cr</code></td>
                        <td>Relative (2D)</td>
                        <td>
                            <code>'cr', dcx1, dcy1, dcx2, dcy2, dx, dy</code>
                        </td>
                        <td>
                            Cubic Bezier Curve (Control points and end point are
                            relative offsets).
                        </td>
                    </tr>
                    <tr>
                        <td><code>x</code></td>
                        <td>Absolute (2D)</td>
                        <td><code>'x', cx1, cy1, cx2, cy2, x, y</code></td>
                        <td>
                            Arc Curve (Control points and end point are
                            absolute).
                        </td>
                    </tr>
                    <tr>
                        <td><code>xr</code></td>
                        <td>Relative (2D)</td>
                        <td>
                            <code>'xr', dcx1, dcy1, dcx2, dcy2, dx, dy</code>
                        </td>
                        <td>
                            Arc Curve (Control points and end point are relative
                            offsets).
                        </td>
                    </tr>

                    <tr>
                        <td><code>n</code></td>
                        <td>Utility</td>
                        <td><code>'n', segments</code></td>
                        <td>
                            Force resolution for the next segment only
                            (Overrides <code>fn</code>).
                        </td>
                    </tr>
                    <tr>
                        <td><code>r</code></td>
                        <td>Modifier (3D Ex)</td>
                        <td><code>'r', angle</code></td>
                        <td>
                            **Rotation Modifier** for the cross-section during
                            `linePaths3dEx` (angle in degrees).
                        </td>
                    </tr>
                    <tr>
                        <td><code>s</code></td>
                        <td>Modifier (3D Ex)</td>
                        <td><code>'s', scaleX, scaleY</code></td>
                        <td>
                            **Scale Modifier** for the cross-section during
                            `linePaths3dEx`.
                        </td>
                    </tr>
                </tbody>
            </table>
            <h3 id="auto-hole">Advanced: Automatic Hole Detection</h3>
            <p>
                The <code>shape()</code> function automatically detects holes
                based on sub-path nesting. If one closed path is entirely inside
                another, it is treated as a cutout/hole. You don't need manual
                hole definitions.
            </p>
            <h3 id="arcpath3d-helper"><code>arcPath3d()</code> Helper</h3>
            <p>
                A helper function to easily generate a smooth 3D path suitable
                for extrusion commands (<code>linePaths3d</code> or
                <code>linePaths3dEx</code>). The configuration accepts
                <code>startAng</code>, <code>endAng</code> (in degrees),
                <code>r</code> (radius), and <code>fn</code> (resolution).
            </p>
            <h3 id="path-examples">Examples</h3>
            <div class="example-block">
                <div class="example-title">Simple Triangle</div>
                <pre><code>const trianglePath = {
    path: [
        'm', 0, 0,
        'l', 10, 0,
        'l', 5, 10,
        'l', 0, 0
    ]
};
const triangleShape = shape(trianglePath);
// Extrude 2 units high
const straightPath = { path: ['m', 0, 0, 0, 'l', 0, 0, 2], fn: 1 };
return linePaths3d(triangleShape, straightPath, false);</code></pre>
            </div>
        </section>
        <hr />
        <div class="nav-buttons">
            <a href="#commands" class="nav-button">Next: Commands &rarr;</a>
            <a href="#top" class="nav-button">↑ Top</a>
        </div>
        <section id="commands">
            <h2>6. scadCSG Commands and How to Use Them</h2>
            <div class="note">
                <p>
                    <strong>3D Coordinate System:</strong> All 3D operations use
                    a **Z-up system** (X=width, Y=length/depth, Z=height).
                </p>
            </div>
            <h3 id="primitives">Primitive Shapes</h3>
            <ul>
                <li><code>sphere({ r, d, fn })</code></li>
                <li><code>cube([x, y, z])</code></li>
                <li><code>cylinder({ r, rt, rb, h, fn })</code></li>
            </ul>
            <h3 id="transformations">Transformations</h3>
            <ul>
                <li>
                    <code>translate([x, y, z], target)</code>: Moves the
                    geometry.
                </li>
                <li>
                    <code>rotate([x, y, z], target)</code>: Rotates the geometry
                    in **degrees** (X, Z, then Y order).
                </li>
                <li>
                    <code>scale([x, y, z], target)</code>: Scales the geometry
                    by factors.
                </li>
                <li>
                    <code>scaleAdd({ x, y, z }, target)</code>: Adds the
                    specified value to the object's dimensions.
                </li>
                <li>
                    <code>scaleTo({ x, y, z }, target)</code>: Scales
                    proportionally to reach a target dimension on one axis.
                </li>
                <li>
                    <code>floor(target)</code>: Moves the object's lowest point
                    to Z=0.
                </li>
                <li>
                    <code
                        >align({ bx, tx, cx, by, ty, cy, bz, tz, cz },
                        target)</code
                    >: Aligns by bounding box.
                </li>
                <li>
                    <code>placement({ command: offset }, obj, ...target)</code>:
                    Aligns **target** objects relative to **obj** using boundary
                    commands and applies an optional offset.
                    <p>
                        The command structure is:
                        **[REF-ANCHOR][TARGET-ALIGN][AXIS]** (e.g., `'ttx':
                        10`).
                    </p>
                    <p>
                        In the Z-Up system, **'t'** is `min` for X/Y, but `max`
                        for Z (top); **'b'** is `max` for X/Y, but `min` for Z
                        (bottom).
                    </p>

                    <ul>
                        <li>
                            **X-Axis (Lateral)**:
                            <ul>
                                <li>**t**: `min.x` boundary</li>
                                <li>**b**: `max.x` boundary</li>
                                <li>**c**: Center X</li>
                            </ul>
                            (Commands: ttx, tbx, tcx, btx, bbx, bcx, ctx, cbx,
                            ccx)
                        </li>
                        <li>
                            **Y-Axis (Depth/Lateral)**:
                            <ul>
                                <li>**t**: `min.y` boundary</li>
                                <li>**b**: `max.y` boundary</li>
                                <li>**c**: Center Y</li>
                            </ul>
                            (Commands: tty, tby, tcy, bty, bby, bcy, cty, cby,
                            ccy)
                        </li>
                        <li>
                            **Z-Axis (Vertical)**:
                            <ul>
                                <li>**t**: `max.z` boundary (Top)</li>
                                <li>**b**: `min.z` boundary (Bottom)</li>
                                <li>**c**: Center Z</li>
                            </ul>
                            (Commands: ttz, tbz, tcz, btz, bbz, bcz, ctz, cbz,
                            ccz)
                        </li>
                    </ul>
                </li>
            </ul>

            <h3 id="csg-operations">CSG Operations</h3>
            <ul>
                <li><code>union(target)</code>: Combines objects.</li>
                <li>
                    <code>difference(mainMesh, target)</code>: Subtracts targets
                    from the main mesh.
                </li>
                <li>
                    <code>intersect(target)</code>: Finds the overlapping
                    volume.
                </li>
                <li>
                    <code>inverseIntersect(target)</code>: Creates the symmetric
                    difference (XOR).
                </li>
            </ul>
            <h3 id="extrusions">2D to 3D Extrusion</h3>
            <p>Functions that convert 2D path data into 3D models.</p>
            <ul>
                <li>
                    <code>shape(shapeData)</code>: Generates a 2D shape object.
                </li>
                <!--<li><code>linePaths3d(target, path, close)</code>: Extrudes a shape along a 3D path (simple, no scale/rotation).</li>-->
                <li>
                    <code>linePaths3d(target, path, close)</code>: Extrudes a
                    shape along a 3D path, respecting scale (<code>'s'</code>)
                    and rotation (<code>'r'</code>) commands in the path data.
                </li>
                <li>
                    <code>arcPath3d(config)</code>: Helper to generate a curved
                    3D path.
                </li>
            </ul>
            <h3 id="3d-imports">3D Imports (Requires <code>await</code>)</h3>
            <p>
                These functions are **asynchronous** and must be called with
                <code>await</code>.
            </p>
            <ul>
                <li><code>importStl(filepath)</code></li>
                <li><code>importObj(filepath)</code></li>
                <li><code>importGlb(filepath)</code></li>
                <li><code>importFbx(filepath)</code></li>
            </ul>
            <h3 id="utilities">Utility Functions</h3>
            <ul>
                <li><code>color(c, target)</code>: Applies a color.</li>
                <li>
                    <code>convexHull(target)</code>: Creates a convex hull
                    around objects.
                </li>
                <li>
                    **<code>boundingBox(...target)</code>**: Calculates the
                    **collective world-space 3D bounding box** for an array of
                    **Three.js objects** (e.g., Meshes or Brushes).
                    <p>
                        <strong>Returns:</strong> A 3D bounding object with axes
                        re-mapped for 3D printing convention:
                    </p>
                    <pre><code>{
    min: { x: Number, y: Number, z: Number }, // y is from Three.js Z, z is from Three.js Y
    max: { x: Number, y: Number, z: Number }
}</code></pre>
                </li>
                <li>
                    **<code>boundingBoxPath(pathObject)</code>**: Calculates the
                    **2D bounding box** ($X$-$Y$) for a path object by first
                    flattening any curves into line segments.
                    <p>
                        <strong>Returns:</strong> A standard 2D bounding object:
                    </p>
                    <pre><code>{
    min: { x: Number, y: Number },
    max: { x: Number, y: Number }
}</code></pre>
                </li>
                <li>
                    <code>subdivide({ resolution }, target)</code>: Refines
                    geometry for smoother surfaces/better boolean ops.
                </li>
                <li>
                    <code>show(target)</code> / <code>hide(target)</code>: Sets
                    visibility flags for debugging/construction.
                </li>
                <li>
                    <code>clone(source, target)</code> /
                    <code>clone(source)</code>: **Creates a deep clone** of a
                    single three.js object (`THREE.Mesh`, `THREE.Shape`,
                    `Brush`, etc.) or a container (Array/Object) holding them.
                    The new objects are independent of the originals. If a
                    `target` is provided, the cloned objects/properties will be
                    placed inside or merged into the target container.
                </li>
            </ul>

            <h3 id="2d-path-manipulation">2D Path Manipulation</h3>
            <p>
                Functions that operate on 2D path data (objects with
                <code>path</code> and <code>fn</code> properties) *before* they
                are turned into 3D geometry.
            </p>
            <ul>
                <li>
                    <code>translatePath([x, y], pathObject)</code>: Moves a 2D
                    path by the specified [x, y] offset.
                </li>
                <li>
                    <code>rotatePath(angleInDegrees, pathObject)</code>: Rotates
                    a 2D path around the origin (0,0).
                </li>
                <li>
                    <code>scalePath([scaleX, scaleY], pathObject)</code>: Scales
                    a 2D path from the origin (0,0).
                </li>
                <li>
                    <code>scaleToPath({ x, y }, pathObject)</code>: Scales a 2D
                    path uniformly to fit a target dimension.
                </li>
                <li>
                    <code>scaleAddPath({ x, y }, pathObject)</code>: Resizes a
                    2D path by adding to its bounding box dimensions.
                </li>
                <li>
                    <code
                        >alignPath({ bx, tx, cx, by, ty, cy }, pathObject)</code
                    >: Aligns a 2D path based on its bounding box.
                </li>
                <li>
                    <code>convertTo2d(pathObject3d)</code> /
                    <code>convertTo3d(pathObject2d, z)</code>: Converts between
                    2D and 3D path formats.
                </li>
            </ul>
            <h3 id="text-functions">
                Text Functions (Requires <code>await</code>)
            </h3>
            <ul>
                <li>
                    <code>await font(fontPath)</code>: Loads a font file (e.g.,
                    TTF).
                </li>
                <li>
                    <code>text({ font, text, fontSize, fn })</code>: Converts
                    text to a 2D path object.
                </li>
            </ul>
        </section>
        <hr />
        <div class="nav-buttons">
            <a href="#examples" class="nav-button">Next: Examples &rarr;</a>
            <a href="#top" class="nav-button">↑ Top</a>
        </div>
        <section id="examples">
            <h2>7. Examples</h2>
            <div class="example-block" id="example-sphere-on-cube">
                <div class="example-title">Sphere on a Cube (Union)</div>
                <pre><code>const base = cube([20, 20, 5]);
// Translate the sphere up 5 units so it sits on top of the base
const top = translate([10, 10, 5], sphere({ r: 5 }));
return union([base, top]);</code></pre>
            </div>
            <div class="example-block" id="example-hole">
                <div class="example-title">Hole in a Cube (Difference)</div>
                <pre><code>const main = cube([20, 20, 20]);
const hole = cylinder({ r: 5, h: 25 });
// Center the hole (at [10, 10]) and move it down [-2.5] so it cuts all the way through
return difference(main, [translate([10, 10, -2.5], hole)]);</code></pre>
            </div>
            <div class="example-block" id="example-text">
                <div class="example-title">Text Extrusion</div>
                <pre><code>// Requires await
const myFont = await font("/fonts/arial.ttf");
const textPath = text({ font: myFont, text: "CSG", fontSize: 10 });
const textShape = shape(textPath);
// Extrude the text 1 unit high
const extrusionPath = { path: ['m', 0, 0, 0, 'l', 0, 0, 1], fn: 1 };
return linePaths3d(textShape, extrusionPath, false);</code></pre>
            </div>
            <div class="example-block" id="example-include">
                <div class="example-title">
                    Using include() for Reusable Parts
                </div>
                <pre><code>// In a CSG script
const utils = include("MyUtilsLibrary"); // Assuming 'MyUtilsLibrary' is an Editor Script tab
return utils.bolt(5, 20); // Calls the exported bolt function</code></pre>
            </div>
        </section>
        <hr />
        <div class="nav-buttons">
            <a href="#top" class="nav-button">↑ Top</a>
        </div>
        <button id="jump-back-btn">&#x21A9; Jump Back</button>
        <script>
            const scrollHistory = []
            const jumpBackBtn = document.getElementById('jump-back-btn')
            // Handle clicks on internal anchor links (#...)
            document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault()
                    const targetId = this.getAttribute('href')
                    const targetElement = document.querySelector(targetId)
                    if (targetElement) {
                        // Save current scroll position to history BEFORE navigating
                        scrollHistory.push(window.scrollY)
                        updateJumpBackButton()
                        // Smooth scroll to target (with small offset for fixed headers)
                        window.scrollTo({
                            top: targetElement.offsetTop - 20,
                            behavior: 'smooth'
                        })
                    }
                })
            })
            // Jump Back button: restore last saved scroll position
            jumpBackBtn.addEventListener('click', () => {
                if (scrollHistory.length > 0) {
                    const prevPos = scrollHistory.pop()
                    window.scrollTo({
                        top: prevPos,
                        behavior: 'smooth'
                    })
                    updateJumpBackButton()
                }
            })
            // Show/hide the button based on history size
            function updateJumpBackButton() {
                jumpBackBtn.style.display =
                    scrollHistory.length > 0 ? 'block' : 'none'
            }
            // Initialize button state
            updateJumpBackButton()
        </script>
    </body>
</html>
